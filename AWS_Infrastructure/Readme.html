<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.17">
<title>CDP Private Cloud Setup on AWS Infrastructure</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="article data-line-1">
<div id="header">
<h1>CDP Private Cloud Setup on AWS Infrastructure</h1>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_introduction">Introduction</a></li>
<li><a href="#_prerequisites">Prerequisites</a></li>
<li><a href="#_infrastructure_setup">Infrastructure Setup</a>
<ul class="sectlevel2">
<li><a href="#Hardware_Table">Hardware</a></li>
<li><a href="#_software">Software</a></li>
<li><a href="#_summary">Summary</a></li>
</ul>
</li>
<li><a href="#Preliminary_Work">Preliminary Work</a>
<ul class="sectlevel2">
<li><a href="#_create_base_ami">Create Base AMI</a></li>
<li><a href="#DNS_server_setup">Install and Setup of IPA services</a></li>
<li><a href="#_setup_reverse_dns_zone">Setup Reverse DNS Zone</a></li>
<li><a href="#Cluster_Hosts">Add all the machines to the DNS server</a></li>
<li><a href="#Create_Local_Mirror">Create Local mirror for ECS bits</a></li>
</ul>
</li>
<li><a href="#_private_cloud_base_setup">Private Cloud Base Setup</a>
<ul class="sectlevel2">
<li><a href="#_download_the_installer_cloudera_repository_file">Download the Installer &amp; Cloudera Repository file</a></li>
<li><a href="#_install_cloudera_manager_with_embedded_database">Install <strong>Cloudera Manager</strong> with <strong>Embedded Database</strong>.</a></li>
<li><a href="#_setup_private_cloud_base_cluster">Setup Private Cloud Base Cluster</a></li>
</ul>
</li>
<li><a href="#_private_cloud_data_services_setup">Private Cloud Data Services Setup</a>
<ul class="sectlevel2">
<li><a href="#_prepare_ecs_nodes">Prepare ECS Nodes</a></li>
<li><a href="#_install_ecs">Install ECS</a></li>
</ul>
</li>
<li><a href="#CDP_Console">Accessing CDP Private Cloud</a></li>
<li><a href="#_cloudera_data_engineering_cde">Cloudera Data Engineering (<strong>CDE</strong>)</a>
<ul class="sectlevel2">
<li><a href="#_cdp_base_cluster_requirements">CDP Base cluster requirements</a></li>
<li><a href="#_enabling_cde_service">Enabling CDE Service</a></li>
<li><a href="#_create_virtual_cluster">Create Virtual Cluster</a></li>
<li><a href="#_initializing_virtual_cluster">Initializing Virtual Cluster</a></li>
<li><a href="#_configuring_ldap_users_on_cde">Configuring LDAP Users on CDE</a></li>
</ul>
</li>
<li><a href="#_cloudera_data_warehouse_cdw">Cloudera Data Warehouse (<strong>CDW</strong>)</a>
<ul class="sectlevel2">
<li><a href="#_enable_cdw_environment_and_creation_of_database_catalog">Enable CDW environment and creation of Database Catalog</a></li>
<li><a href="#_create_virtual_warehouse">Create Virtual Warehouse</a></li>
</ul>
</li>
<li><a href="#_cloudera_machine_learning_cml">Cloudera Machine Learning (<strong>CML</strong>)</a>
<ul class="sectlevel2">
<li><a href="#_ml_workspace_creation">ML Workspace Creation</a></li>
<li><a href="#_create_project">Create Project</a></li>
<li><a href="#_hadoop_authentication">Hadoop Authentication</a></li>
<li><a href="#_explore_cml_ides">Explore CML IDEs</a></li>
</ul>
</li>
<li><a href="#_appendix">Appendix</a>
<ul class="sectlevel2">
<li><a href="#Add_Users_on_IPA">Add users on FreeIPA</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph data-line-4">
<p>This document provides all the required information for Cloudera Partners to setup and install CDP Private Cloud on AWS Infrastructure(<strong>EC2</strong>). In addition to exploring the benefits of CDP Private Cloud with its rich Data Services, this setup can also be used for <strong>ISV/IHV</strong> certification, getting a Hands-on experience, or for any demos with potential customers.</p>
</div>
</div>
</div>
<div class="sect1 data-line-7">
<h2 id="_introduction">Introduction</h2>
<div class="sectionbody">
<div class="paragraph data-line-9">
<p>Cloudera Data Platform is a single platform that has two form factors CDP Public and CDP Private cloud.</p>
</div>
<div class="paragraph data-line-11">
<p><strong>CDP Public Cloud</strong> is an integrated analytics and data management platform deployed on <strong>cloud services</strong>. It consists of a number of cloud services designed to address specific enterprise data cloud use cases.
This includes Data Hub powered by Cloudera Runtime, self-service experiences (Data Warehouse, Machine Learning, and Data Engineering) running on containers, the administrative layer (Management Console), and SDX services (Data Lake, Data Catalog, Replication Manager, and Workload Manager).</p>
</div>
<div class="paragraph data-line-14">
<p><strong>CDP Private Cloud</strong> is an integrated analytics and data management platform deployed in <strong>private data centers</strong>. It consists of CDP Private Cloud Base and CDP Private Cloud Data Services and offers broad data analytics and artificial intelligence functionality along with secure user access and data governance features. CDP Private Cloud (PvC) data services components run on containerized cluster and thus requires a container orchestration engine to manage all the workloads. CDP PvC offers installation with two orchestration engines.</p>
</div>
<div class="ulist data-line-16">
<ul>
<li class="data-line-16">
<p>Openshift Container Platform</p>
</li>
<li class="data-line-18">
<p>Embedded Container Service (Cloudera managed)</p>
</li>
</ul>
</div>
<div class="paragraph data-line-20">
<p>In this document, we focus on CDP Private Cloud setup with <strong>ECS</strong>. Let&#8217;s have a look at the prerequisites before proceeding with the actual setup.</p>
</div>
</div>
</div>
<div class="sect1 data-line-22">
<h2 id="_prerequisites">Prerequisites</h2>
<div class="sectionbody">
<div class="paragraph data-line-24">
<p><strong>Entitlements</strong></p>
</div>
<div class="paragraph data-line-26">
<p>Your License key must have the PvC DS entitlement. A current key without the entitlement will block access to ECS bits. Please raise a ticket or reach out to the Cloudera POC to get the necessary entitlements.</p>
</div>
<div class="paragraph data-line-28">
<p><strong>AWS</strong></p>
</div>
<div class="paragraph data-line-30">
<p>Administrator access to AWS account. Please verify the resource limits in the region where you wish to deploy the cloud resources.</p>
</div>
</div>
</div>
<div class="sect1 data-line-32">
<h2 id="_infrastructure_setup">Infrastructure Setup</h2>
<div class="sectionbody">
<div class="paragraph data-line-34">
<p>Below table summarizes the machines used for this POC. This is a minimum requirement, One can increase the number of machines to achieve High Availability and Fault Tolerance. If this cluster is not meant to perform any benchmarking or performance test, one can proceed ahead with this infrastructure.</p>
</div>
<div class="sect2 data-line-36">
<h3 id="Hardware_Table">Hardware</h3>
<table class="tableblock frame-all grid-all stretch data-line-39">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">AWS Resource</th>
<th class="tableblock halign-left valign-top">Machine Size</th>
<th class="tableblock halign-left valign-top">Count</th>
<th class="tableblock halign-left valign-top">CDP Role</th>
<th class="tableblock halign-left valign-top">Storage</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">EC2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">m5.4xlarge</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FreeIPA server</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">50 GB EBS Root volume</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">EC2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">m5.8xlarge</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CDP Base Cluster</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">200 GB EBS Root volume</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">EC2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">m5.4xlarge</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CDP ECS Cluster</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">150 GB Root Volume and  2 TB For ECS</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Elastic IP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">For Data Services &amp; Cloudera Manager</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NA</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2 data-line-51">
<h3 id="_software">Software</h3>
<div class="paragraph data-line-54">
<p>Below table summarizes the list of softwares/packages and their use for setting up CDP PvC cluster.</p>
</div>
<table class="tableblock frame-all grid-all stretch data-line-57">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Software</th>
<th class="tableblock halign-left valign-top">Version</th>
<th class="tableblock halign-left valign-top">Node</th>
<th class="tableblock halign-left valign-top">Role</th>
<th class="tableblock halign-left valign-top">Availability</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Centos</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7.9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All Machines</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Operating System</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">AMI</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IPA Server</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Latest</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IPA Machine</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">For Setting up KDC,DNS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yum Package</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IPA Client</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Latest</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All Machines</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IPA/DNS Communication</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yum Package</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">NFS Utility Package</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Latest</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All Machine</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NFS Communication</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yum package</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cloudera Manager</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7.9.5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CDP Base</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Management</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cloudera Repo</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cloudera Runtime</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7.1.8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CDP Base and ECS Nodes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Runtime</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cloudera Repo</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cloudera ECS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.5.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ECS Cluster Nodes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Data Services</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cloudera Repo</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OpenJDK</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All Machines</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All CDP Hosts</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cloudera Repo</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2 data-line-71">
<h3 id="_summary">Summary</h3>
<div class="paragraph data-line-72">
<p>The below table contains the names assigned to the EC2 instances and to some other required components. Going forward in this document will refer to them by name.</p>
</div>
<div class="paragraph data-line-75">
<p><strong>Note:</strong> The hostnames mentioned here are just for convenience. You may choose to have the hostnames as per your requirements.</p>
</div>
<table class="tableblock frame-all grid-all stretch data-line-78">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">pvcbasemaster</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">One Node CDP Private Cloud Base Master</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">pvcbaseworker1 to pvcbaseworker3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CDP Base Cluster Worker Nodes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">pvcipaserver</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FreeIPA Server</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">pvcecsmaster</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ECS Master Node</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">pvcecs1 to pvcecs6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ECS Worker Nodes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PVCSG</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Common Security Group For All EC2.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PVCBASE.COM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dummy Domain For POC Purpose</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-90">
<p>Once you have familiarized yourself with all the information mentioned above, you can start with the preliminary work for CDP Base setup.</p>
</div>
</div>
</div>
</div>
<div class="sect1 data-line-92">
<h2 id="Preliminary_Work">Preliminary Work</h2>
<div class="sectionbody">
<div class="paragraph data-line-94">
<p>Before getting into the actual installation of CDP Private Cloud Base &amp; Data Services we need to prepare our machines and perform some steps to meet the prerequisites.</p>
</div>
<div class="sect2 data-line-96">
<h3 id="_create_base_ami">Create Base AMI</h3>
<div class="paragraph data-line-98">
<p>In this step, an AMI will be created which will serve as the base AMI to provision all the EC2 instances that form the CDP PvC cluster.</p>
</div>
<div class="sect3 data-line-100">
<h4 id="_step1">Step1</h4>
<div class="ulist data-line-102">
<ul>
<li class="data-line-102">
<p>Login to the AWS account and select the Region in which you want to deploy the cluster.</p>
</li>
<li class="data-line-104">
<p>Start a t2.micro instance by using the AMI <strong>CentOS 7 (x86_64) - with Updates HVM</strong> and deploy it in the Public Subnet.</p>
</li>
<li class="data-line-106">
<p>Ensure that the OS version is Centos 7.9.</p>
</li>
<li class="data-line-108">
<p>To verify the version, run the below command. It should return CentOS Linux release 7.9.2009 (Core).</p>
</li>
</ul>
</div>
<div class="listingblock data-line-110">
<div class="content">
<pre>cat /etc/centos-release</pre>
</div>
</div>
<div class="imageblock data-line-113">
<div class="content">
<img src="images/centos_ver.png" alt="centos ver">
</div>
</div>
<div class="ulist data-line-115">
<ul>
<li class="data-line-115">
<p>If the output shows the version as Centos 7.6, then run the below command to update the OS to 7.9. Before updating, switch to root account.</p>
</li>
</ul>
</div>
<div class="listingblock data-line-117">
<div class="content">
<pre>sudo su - root
yum update -y</pre>
</div>
</div>
<div class="ulist data-line-122">
<ul>
<li class="data-line-122">
<p>Generate a password protected private key by using the below command and create a password for this private key by entering it when prompted.</p>
</li>
</ul>
</div>
<div class="listingblock data-line-124">
<div class="content">
<pre>ssh-keygen -t rsa  -f /root/.ssh/id_rsa_new</pre>
</div>
</div>
<div class="imageblock data-line-128">
<div class="content">
<img src="images/ssh-keygen-pw.png" alt="ssh keygen pw">
</div>
</div>
<div class="ulist data-line-130">
<ul>
<li class="data-line-130">
<p>Add the newly created key into authorized_keys by using below command.</p>
</li>
</ul>
</div>
<div class="listingblock data-line-132">
<div class="content">
<pre>cat /root/.ssh/id_rsa_new.pub &gt;&gt; /root/.ssh/authorized_keys</pre>
</div>
</div>
<div class="ulist data-line-136">
<ul>
<li class="data-line-136">
<p>Download the <strong>id_rsa_new</strong> key file to your local machine by using sftp. This will be required at the time of installation.</p>
</li>
</ul>
</div>
</div>
<div class="sect3 data-line-139">
<h4 id="_step2">Step2</h4>
<div class="ulist data-line-141">
<ul>
<li class="data-line-141">
<p>Reboot the instance and re-login and change the user to <strong>root</strong>.</p>
</li>
<li class="data-line-143">
<p><strong>Disable SELinux:</strong> Open the file <strong>/etc/selinux/config</strong> for editing and update the value as shown below.</p>
</li>
</ul>
</div>
<div class="listingblock data-line-145">
<div class="content">
<pre>    vi /etc/selinux/config
    SELINUX=disabled</pre>
</div>
</div>
<div class="imageblock data-line-150">
<div class="content">
<img src="images/selinux.png" alt="selinux">
</div>
</div>
<div class="ulist data-line-153">
<ul>
<li class="data-line-153">
<p><strong>Set swappiness to 1:</strong> Open the file <strong>/etc/sysctl.conf</strong> for editing and add the below line.</p>
</li>
</ul>
</div>
<div class="listingblock data-line-155">
<div class="content">
<pre>vi /etc/sysctl.conf
vm.swappiness=1</pre>
</div>
</div>
<div class="paragraph data-line-160">
<p><span class="image"><img src="images/swappiness.png" alt="swappiness"></span></p>
</div>
<div class="ulist data-line-162">
<ul>
<li class="data-line-162">
<p><strong>Disable Transparent Huge Pages:</strong> Open the file <strong>/etc/rc.d/rc.local</strong> for editing and add the below lines.</p>
</li>
</ul>
</div>
<div class="listingblock data-line-164">
<div class="content">
<pre>vi /etc/rc.d/rc.local
echo never &gt; /sys/kernel/mm/transparent_hugepage/enabled
echo never &gt; /sys/kernel/mm/transparent_hugepage/defrag</pre>
</div>
</div>
<div class="ulist data-line-170">
<ul>
<li class="data-line-170">
<p><strong>Disable IPV6:</strong> Open the file <strong>/etc/rc.d/rc.local</strong> for editing and add the below lines.</p>
</li>
</ul>
</div>
<div class="listingblock data-line-172">
<div class="content">
<pre>vi /etc/rc.d/rc.local
sysctl -w net.ipv6.conf.all.disable_ipv6=1
sysctl -w net.ipv6.conf.default.disable_ipv6=1
sysctl -w net.ipv6.conf.lo.disable_ipv6=0</pre>
</div>
</div>
<div class="imageblock data-line-179">
<div class="content">
<img src="images/huge_page_ipv6.png" alt="huge page ipv6">
</div>
</div>
<div class="ulist data-line-181">
<ul>
<li class="data-line-181">
<p><strong>Add execute permission:</strong> Run the below command to add execute permission to the file <strong>/etc/rc.d/rc.local</strong>.</p>
</li>
</ul>
</div>
<div class="listingblock data-line-183">
<div class="content">
<pre>chmod +x /etc/rc.d/rc.local</pre>
</div>
</div>
<div class="ulist data-line-187">
<ul>
<li class="data-line-187">
<p><strong>Install packages:</strong> Install the packages <strong><em>ipa-client</em></strong>, <strong><em>wget</em></strong>, <strong><em>ntpd</em></strong> through <strong>yum</strong> using the below command.</p>
</li>
</ul>
</div>
<div class="listingblock data-line-189">
<div class="content">
<pre>yum install -y ipa-client wget ntpd</pre>
</div>
</div>
</div>
<div class="sect3 data-line-193">
<h4 id="AMI_creation">Step3</h4>
<div class="ulist data-line-195">
<ul>
<li class="data-line-195">
<p><strong>Create AMI:</strong> Open AWS console and create AMI of this machine. Once the AMI is in <strong>"Available"</strong> state, terminate this instance.</p>
</li>
</ul>
</div>
<div class="paragraph data-line-197">
<p>For all the EC2 instances to be created next, this AMI will be used.</p>
</div>
</div>
</div>
<div class="sect2 data-line-199">
<h3 id="DNS_server_setup">Install and Setup of IPA services</h3>
<div class="paragraph data-line-201">
<p>In this step a DNS server will be configured and will set up this using an IPA server. In this step we will also configure  other services like KDC, Directory Service on this IPA server. Also, please note that the hostnames used in this installation can be modified as per your requirements.</p>
</div>
<div class="sect3 data-line-203">
<h4 id="_step1_2">Step1</h4>
<div class="ulist data-line-205">
<ul>
<li class="data-line-205">
<p>Create an EC2 instance using AMI created at <a href="#AMI_creation">Step3</a> . Refer to the <a href="#Hardware_Table">Hardware</a> table for machine type , EBS Volume Size, and associated Security Group.</p>
</li>
<li class="data-line-207">
<p>Once logged into the above created instance, install the following packages through yum using the below command.</p>
</li>
</ul>
</div>
<div class="listingblock data-line-210">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">yum install -y ipa-server bind bind-dyndb-ldap ipa-server-dns firewalld</code></pre>
</div>
</div>
<div class="imageblock data-line-214">
<div class="content">
<img src="images/ipa_packages.png" alt="ipa packages">
</div>
</div>
<div class="ulist data-line-216">
<ul>
<li class="data-line-216">
<p>Set the hostname of this EC2 instance. The hostname should be FQDN.</p>
</li>
</ul>
</div>
<div class="listingblock data-line-219">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">sudo hostnamectl set-hostname --static ipaserver.cdppvcds.com</code></pre>
</div>
</div>
<div class="ulist data-line-223">
<ul>
<li class="data-line-223">
<p>Take the private IP of this machine and add an entry in <strong><em>/etc/hosts</em></strong> file.</p>
</li>
</ul>
</div>
<div class="listingblock data-line-226">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">&lt;PRIVATE_IP_OF_MACHINE&gt; ipaserver.cdppvcds.com</code></pre>
</div>
</div>
<div class="ulist data-line-230">
<ul>
<li class="data-line-230">
<p><strong>Reboot the machine and login back.</strong></p>
</li>
</ul>
</div>
</div>
<div class="sect3 data-line-232">
<h4 id="_step2_2">Step2</h4>
<div class="ulist data-line-234">
<ul>
<li class="data-line-234">
<p>Verify the hostname of the IPA server with the below command. It should return the same FQDN set in the previous step.</p>
</li>
</ul>
</div>
<div class="listingblock data-line-237">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">cat /etc/hostname</code></pre>
</div>
</div>
<div class="ulist data-line-241">
<ul>
<li class="data-line-241">
<p>Configure the IPA server by running below command as a root user.</p>
</li>
</ul>
</div>
<div class="listingblock data-line-243">
<div class="content">
<pre>ipa-server-install --setup-dns</pre>
</div>
</div>
<div class="ulist data-line-247">
<ul>
<li class="data-line-247">
<p>Follow the on screen instructions and provide the inputs for the parameters as per the table below.</p>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-all stretch data-line-250">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Server host name [ipaserver.cdppvcds.com]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>ipaserver.cdppvcds.com</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Please confirm the domain name [cdppvcds.com]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>cdppvcds.com</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Please provide a realm name [CDPPVCDS.COM]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>CDPPVCDS.COM</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Directory Manager password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;Password For Directory Manager&gt;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Password (confirm)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;Confirm Password&gt;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IPA admin password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;Password For IPA Admin&gt;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Password (confirm)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;Confirm Password&gt;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Do you want to configure DNS forwarders? [yes]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Do you want to search for missing reverse zones? [yes]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Continue to configure the system with these values? [no]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-265">
<p>Please keep the same password for both Directory manager and IPA admin so that there is no confusion in future while using the same. Also, note down the password separately.</p>
</div>
<div class="paragraph data-line-267">
<p><strong>The setup will take 10-15 Minutes. If everything goes fine then you should get an output similar to the below screenshot.</strong></p>
</div>
<div class="imageblock data-line-269">
<div class="content">
<img src="images/ipa_server_setup.png" alt="ipa server setup">
</div>
</div>
<div class="ulist data-line-271">
<ul>
<li class="data-line-271">
<p><em>If the installation fails, then run the below command to uninstall and retry with the above command for installation.</em></p>
</li>
</ul>
</div>
<div class="listingblock data-line-273">
<div class="content">
<pre>ipa-server-install --uninstall</pre>
</div>
</div>
<div class="ulist data-line-277">
<ul>
<li class="data-line-277">
<p>Update firewall rule to allow ports using  below command.</p>
</li>
</ul>
</div>
<div class="listingblock data-line-279">
<div class="content">
<pre>firewall-cmd --permanent --add-port={80/tcp,443/tcp,389/tcp,636/tcp,88/tcp,464/tcp,53/tcp,88/udp,464/udp,53/udp,123/udp,749/tcp,749/udp}</pre>
</div>
</div>
<div class="ulist data-line-283">
<ul>
<li class="data-line-283">
<p>Verify the setup by generating a ticket for the admin user. Execute <strong>kinit admin</strong> and provide the directory password given during ipa server installation. The command should generate the ticket and should be listed by executing <strong>klist -e</strong>. This command should return the below output.</p>
</li>
</ul>
</div>
<div class="paragraph data-line-285">
<p><span class="image"><img src="images/klist_verify.png" alt="klist verify"></span></p>
</div>
</div>
</div>
<div class="sect2 data-line-287">
<h3 id="_setup_reverse_dns_zone">Setup Reverse DNS Zone</h3>
<div class="paragraph data-line-289">
<p>In this step we will be setting up a reverse DNS zone on the FreeIPA server for reverse lookup and we will also update the network configuration files on the IPA server to use the Name Server created in <a href="#DNS_server_setup">Install and Setup of IPA services</a> .</p>
</div>
<div class="sect3 data-line-291">
<h4 id="_step1_3">Step1</h4>
<div class="ulist data-line-293">
<ul>
<li class="data-line-293">
<p>Login to IPA Server as root and get the private IP of the server with the below command.</p>
</li>
</ul>
</div>
<div class="listingblock data-line-296">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">hostname -i</code></pre>
</div>
</div>
<div class="ulist data-line-300">
<ul>
<li class="data-line-300">
<p>Open the file <strong>/etc/resolv.conf</strong> in edit mode and add the following.</p>
</li>
</ul>
</div>
<div class="listingblock data-line-302">
<div class="content">
<pre>nameserver &lt;PRIVATE_IP_OF_IPASERVER&gt;</pre>
</div>
</div>
<div class="paragraph data-line-306">
<p>Make sure the above is added above any other nameserver entry. The contents of the file must look similar to the below.</p>
</div>
<div class="imageblock data-line-308">
<div class="content">
<img src="images/resolv_conf.png" alt="resolv conf">
</div>
</div>
<div class="ulist data-line-310">
<ul>
<li class="data-line-310">
<p>The above changes are temporary and would get overwritten if the machine is rebooted. In order to keep the nameserver entry persistent, open the file <strong>/etc/sysconfig/network</strong> in edit mode and add below entries.</p>
</li>
</ul>
</div>
<div class="listingblock data-line-312">
<div class="content">
<pre>NETWORKING=yes
NISDOMAIN=&lt;domain&gt;
DNS1=&lt;Private_IP_Of_IPA_Server&gt;
NOZEROCONF=yes</pre>
</div>
</div>
<div class="paragraph data-line-319">
<p>The file content must look similar to the below.</p>
</div>
<div class="paragraph data-line-321">
<p><span class="image"><img src="images/sysconfig_network.png" alt="sysconfig network"></span></p>
</div>
<div class="ulist data-line-323">
<ul>
<li class="data-line-323">
<p>Reboot the machine and verify the contents of <strong>/etc/resolv.conf</strong> are unchanged and ensure that there is an entry of our nameserver.</p>
</li>
<li class="data-line-325">
<p>Run the below command to authenticate as admin through kadmin and enter the directory password.</p>
</li>
</ul>
</div>
<div class="listingblock data-line-327">
<div class="content">
<pre>kinit admin</pre>
</div>
</div>
<div class="ulist data-line-331">
<ul>
<li class="data-line-331">
<p>Take the CIDR block of the VPC in which the EC2 instances are created and create a reverse DNS zone by executing the below command on the IPA Server machine.</p>
</li>
</ul>
</div>
<div class="listingblock data-line-333">
<div class="content">
<pre>ipa dnszone-add --name-from-ip=&lt;YOUR_VPC_CIDR&gt;</pre>
</div>
</div>
<div class="ulist data-line-336">
<ul>
<li class="data-line-336">
<p>If your VPC has a CIDR <strong>172.31.0.0/16</strong>, then the command looks as below.</p>
</li>
</ul>
</div>
<div class="listingblock data-line-337">
<div class="content">
<pre>ipa dnszone-add --name-from-ip=172.31.0.0/16</pre>
</div>
</div>
<div class="ulist data-line-341">
<ul>
<li class="data-line-341">
<p>Once you execute the above command, accept the default value by hitting the enter key. It will create a reverse DNS zone by name 31.172.in-addr.arpa. (with a trailing dot)</p>
</li>
</ul>
</div>
<div class="imageblock data-line-343">
<div class="content">
<img src="images/ipa_dns_zone_add.png" alt="ipa dns zone add">
</div>
</div>
<div class="ulist data-line-345">
<ul>
<li class="data-line-345">
<p>Add the entry of this IPA server machine to the reverse DNS zone . We need to add the IPV4 address in reverse order. The first two octets are already added in the reverse zone above. Now we need to create a record for this machine inside that zone . In the command below you need to add the record by providing the last two octets of your machine&#8217;s private IPV4 in reverse order. Include the trailing dot after the machine name.</p>
</li>
</ul>
</div>
<div class="listingblock data-line-347">
<div class="content">
<pre>ipa dnsrecord-add &lt;2nd&gt;.&lt;1st&gt;.in-addr.arpa. &lt;4th&gt;.&lt;3rd&gt; --ptr-rec &lt;ipaserver FQDN&gt;.
ipa dnsrecord-add 31.172.in-addr.arpa. 119.40 --ptr-rec ipaserver.cdppvcds.com.</pre>
</div>
</div>
<div class="paragraph data-line-352">
<p><strong>Please note that there is a trailing dot after the IPASERVER FQDN in the above command.</strong></p>
</div>
<div class="imageblock data-line-354">
<div class="content">
<img src="images/ipa_dnsrecord_add.png" alt="ipa dnsrecord add">
</div>
</div>
<div class="ulist data-line-356">
<ul>
<li class="data-line-356">
<p>The above command should succeed. In order to validate it, we need to verify the forward and reverse lookup on this machine.</p>
<div class="ulist data-line-358">
<ul>
<li class="data-line-358">
<p>Verify the Forward lookup by running the below command. This command should return the IPV4 of the machine in the <strong>Answer</strong> Section.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock data-line-361">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">dig &lt;FQDN of the IPASERVER&gt; A
Ex:- dig ipaserver.cdppvcds.com A</code></pre>
</div>
</div>
<div class="paragraph data-line-366">
<p>Sample output shown below.</p>
</div>
<div class="imageblock data-line-368">
<div class="content">
<img src="images/dig_A.png" alt="dig A">
</div>
</div>
<div class="ulist data-line-370">
<ul>
<li class="data-line-370">
<p>Verify the Reverse lookup by running the below command. This command should return the hostname of the machine in the <strong>Answer</strong> Section.</p>
</li>
</ul>
</div>
<div class="listingblock data-line-372">
<div class="content">
<pre>dig -x &lt;Private_IP_of_IPASERVER&gt;
dig -x 172.31.40.119</pre>
</div>
</div>
<div class="paragraph data-line-377">
<p>Sample output shown below.</p>
</div>
<div class="imageblock data-line-379">
<div class="content">
<img src="images/dig_x.png" alt="dig x">
</div>
</div>
<div class="ulist data-line-381">
<ul>
<li class="data-line-381">
<p>After the setup is complete, we need to make a kerberos config change which gets enabled automatically post the ipa server setup. Open the file <strong>/etc/krb5.conf</strong> in edit mode and comment out the line related to <strong>ccache_name</strong> as shown below.</p>
</li>
</ul>
</div>
<div class="listingblock data-line-384">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">default_ccache_name = KEYRING:persistent:%{uid}</code></pre>
</div>
</div>
<div class="imageblock data-line-388">
<div class="content">
<img src="images/ipa_kerb_keyring.png" alt="ipa kerb keyring">
</div>
</div>
<div class="ulist data-line-390">
<ul>
<li class="data-line-390">
<p>Post editing the config file, run the below commands to restart all the IPA services.</p>
</li>
</ul>
</div>
<div class="listingblock data-line-392">
<div class="content">
<pre>    ipactl stop
    ipactl start</pre>
</div>
</div>
</div>
</div>
<div class="sect2 data-line-397">
<h3 id="Cluster_Hosts">Add all the machines to the DNS server</h3>
<div class="paragraph data-line-399">
<p>The tasks in this step need to be performed on all Machines except the IPA Server machine.</p>
</div>
<div class="ulist data-line-401">
<ul>
<li class="data-line-401">
<p>Provision the EC2 instances for both Base and ECS clusters. Refer to the <a href="#Hardware_Table">Hardware</a> table for machine specification, EBS Volume, and Security Group details.</p>
</li>
<li class="data-line-403">
<p>Set the static hostname on each machine by using the command below.</p>
</li>
</ul>
</div>
<div class="listingblock data-line-405">
<div class="content">
<pre>sudo hostnamectl set-hostname --static &lt;Hostname_with_Your_Domain&gt;</pre>
</div>
</div>
<div class="ulist data-line-409">
<ul>
<li class="data-line-409">
<p>Either copy the <strong>/etc/resolv.conf</strong> and <strong>/etc/sysconfig/network</strong> file from the IPA server machine to all the machines or update manually on each machine to have the same configuration on all the hosts.</p>
</li>
<li class="data-line-411">
<p>On each machine run the below command to set up the IPA client.</p>
</li>
</ul>
</div>
<div class="listingblock data-line-413">
<div class="content">
<pre>ipa-client-install --force-ntpd</pre>
</div>
</div>
<div class="ulist data-line-417">
<ul>
<li class="data-line-417">
<p>Enter the values for these parameters as below. After entering these values, it should return the message as "The ipa-client-install command was successful".</p>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-all stretch data-line-419">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Continue to configure the system with these values? [no]: yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">User authorized to enroll computers:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">admin</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Password for admin@&lt;Your_Domain&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;Password created earlier&gt;</p></td>
</tr>
</tbody>
</table>
<div class="imageblock data-line-428">
<div class="content">
<img src="images/ipa_client_install.png" alt="ipa client install">
</div>
</div>
<div class="ulist data-line-430">
<ul>
<li class="data-line-430">
<p>Generate the kerberos ticket for admin by running the below command.</p>
</li>
</ul>
</div>
<div class="listingblock data-line-432">
<div class="content">
<pre>kinit admin</pre>
</div>
</div>
<div class="ulist data-line-436">
<ul>
<li class="data-line-436">
<p>Once the ipa-client configuration is successful we need to create a record in the Reverse DNS zone as well for each machine. Use the below command as reference and make changes as per your configuration/machines private IP and Hostname.</p>
</li>
</ul>
</div>
<div class="listingblock data-line-438">
<div class="content">
<pre>Private IP of the EC2 instance: 172.31.0.234
Hostname of the EC2 instance:   cdpbase.cdppvcds.com</pre>
</div>
</div>
<div class="paragraph data-line-443">
<p>Generate the command as shown below and run the same on all the FreeIPA agents, that includes all the nodes of Base and ECS cluster.</p>
</div>
<div class="listingblock data-line-446">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">ipa dnsrecord-add &lt;2nd&gt;.&lt;1st&gt;.in-addr.arpa. &lt;4th&gt;.&lt;3rd&gt; --ptr-rec &lt;IPA_Client FQDN&gt;.

ipa dnsrecord-add 31.172.in-addr.arpa. 234.0 --ptr-rec cdpbase.cdppvcds.com.</code></pre>
</div>
</div>
<div class="imageblock data-line-452">
<div class="content">
<img src="images/ipa_dns_record_ipa_agent.png" alt="ipa dns record ipa agent">
</div>
</div>
<div class="ulist data-line-454">
<ul>
<li class="data-line-454">
<p>The record for the machine should be created in the Reverse DNS zone.</p>
</li>
<li class="data-line-456">
<p>Verify the Forward and Reverse Lookup from each machine as mentioned previously.</p>
<div class="ulist data-line-458">
<ul>
<li class="data-line-458">
<p>Verify the Forward lookup by running the below command. This command should return the IPV4 of the machine in the <strong>Answer</strong> Section.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock data-line-461">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">dig &lt;FQDN of the IPAAGENT&gt; A
Ex:- dig cdpbase.cdppvcds.com A</code></pre>
</div>
</div>
<div class="paragraph data-line-466">
<p>Sample output shown below.</p>
</div>
<div class="imageblock data-line-468">
<div class="content">
<img src="images/dig_A_agent.png" alt="dig A agent">
</div>
</div>
<div class="ulist data-line-470">
<ul>
<li class="data-line-470">
<p>Verify the Reverse lookup by running the below command. This command should return the hostname of the machine in the <strong>Answer</strong> Section.</p>
</li>
</ul>
</div>
<div class="listingblock data-line-472">
<div class="content">
<pre>dig -x &lt;Private_IP_of_IPAAGENT&gt;
dig -x 172.31.0.234</pre>
</div>
</div>
<div class="paragraph data-line-477">
<p>Sample output shown below.</p>
</div>
<div class="imageblock data-line-479">
<div class="content">
<img src="images/dig_x_agent.png" alt="dig x agent">
</div>
</div>
</div>
<div class="sect2 data-line-481">
<h3 id="Create_Local_Mirror">Create Local mirror for ECS bits</h3>
<div class="paragraph data-line-483">
<p>This is an optional step however if performed, it can save a good amount of time during the ECS installation. The total size of ECS bits/images is nearly <strong>85G</strong> and the installer will take time to download these during the actual installation.</p>
</div>
<div class="ulist data-line-485">
<ul>
<li class="data-line-485">
<p>Identify any machine from the EC2 instances created before and install httpd by using the below command.</p>
</li>
</ul>
</div>
<div class="listingblock data-line-487">
<div class="content">
<pre>yum install -y httpd</pre>
</div>
</div>
<div class="ulist data-line-491">
<ul>
<li class="data-line-491">
<p>Start the httpd service and enable it to run even after reboot with the commands below.</p>
</li>
</ul>
</div>
<div class="listingblock data-line-493">
<div class="content">
<pre>systemctl start httpd
systemctl enable httpd</pre>
</div>
</div>
<div class="ulist data-line-498">
<ul>
<li class="data-line-498">
<p>Create a directory to save the ECS images.</p>
</li>
</ul>
</div>
<div class="listingblock data-line-500">
<div class="content">
<pre>mkdir -p /var/www/html/cdp-pvc-ds</pre>
</div>
</div>
<div class="ulist data-line-504">
<ul>
<li class="data-line-504">
<p>Navigate to the above created directory and create a new shell script file with the below content.</p>
</li>
</ul>
</div>
<div class="listingblock data-line-506">
<div class="content">
<pre>vi download_ecs.sh</pre>
</div>
</div>
<div class="ulist data-line-510">
<ul>
<li class="data-line-510">
<p>Copy the below script in the newly created file <strong>download_ecs.sh</strong>.</p>
</li>
</ul>
</div>
<div class="listingblock data-line-513">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">echo "Starting the ECS bits download"

wget -l 0 --recursive r-no-parent -e robots=off -nH --cut-dirs=2 --reject="index.html*" -t 10 https://&lt;CDP_LICENSE_USERNAME&gt;:&lt;CDP_LICENSE_PASSWORD&gt;@archive.cloudera.com/p/cdp-pvc-ds/latest/ -P /var/www/html/cdp-pvc-ds/latest

RETURN_VAL=$?

echo "--------------------------------------------------------"

if [[ "${RETURN_VAL}" == 0 ]]; then
    echo "Successfully downloaded."
else
    echo "Download not successful."
fi</code></pre>
</div>
</div>
<div class="ulist data-line-529">
<ul>
<li class="data-line-529">
<p>Run this script in nohup to keep the job running in background.</p>
</li>
</ul>
</div>
<div class="listingblock data-line-531">
<div class="content">
<pre>nohup sh download_ecs.sh &gt; download_ecs.log &amp;</pre>
</div>
</div>
<div class="ulist data-line-535">
<ul>
<li class="data-line-535">
<p>This will take nearly 5-6 hours based on the network speed. Keep checking the logs of download_ecs.log and if you see the <strong>Successfully downloaded</strong> message, then it means all the images got downloaded successfully. To check the logs, you can use any of the below commands.
,shell]</p>
</li>
</ul>
</div>
<div class="listingblock data-line-537">
<div class="content">
<pre>tail -f download_ecs.log
cat download_ecs.log</pre>
</div>
</div>
<div class="ulist data-line-542">
<ul>
<li class="data-line-542">
<p>Once the images got successfully downloaded, please proceed to the CDP Private Cloud Base setup.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1 data-line-552">
<h2 id="_private_cloud_base_setup">Private Cloud Base Setup</h2>
<div class="sectionbody">
<div class="paragraph data-line-553">
<p>This section outlines the steps needed to set up a 4 nodes Private Cloud Base . Below are the prerequisites which base cluster should have before installing/configuring Data Services.</p>
</div>
<div class="sect2 data-line-555">
<h3 id="_download_the_installer_cloudera_repository_file">Download the Installer &amp; Cloudera Repository file</h3>
<div class="ulist data-line-556">
<ul>
<li class="data-line-556">
<p><strong>Step 1:</strong> Login the pvcbasemaster EC2 instance and switch to 'root' user.</p>
</li>
<li class="data-line-557">
<p><strong>Step 2:</strong> Navigate to <strong>/etc/yum.repos.d/</strong> directory</p>
</li>
</ul>
</div>
<div class="listingblock data-line-559">
<div class="content">
<pre>cd /etc/yum.repos.d/</pre>
</div>
</div>
<div class="ulist data-line-563">
<ul>
<li class="data-line-563">
<p><strong>Step 3:</strong> Execute below command after replacing your <strong>Cloudera Paywall Credentials</strong>.</p>
</li>
</ul>
</div>
<div class="listingblock data-line-565">
<div class="content">
<pre>wget  https://&lt;user_name&gt;:&lt;password&gt;@archive.cloudera.com/p/cm7/7.9.5/redhat7/yum/cloudera-manager.repo</pre>
</div>
</div>
<div class="ulist data-line-568">
<ul>
<li class="data-line-568">
<p><strong>Step 4:</strong> Navigate to <strong>/tmp/</strong> directory</p>
</li>
</ul>
</div>
<div class="listingblock data-line-570">
<div class="content">
<pre>cd /tmp/</pre>
</div>
</div>
<div class="ulist data-line-574">
<ul>
<li class="data-line-574">
<p><strong>Step 5:</strong> Download the <strong>cloudera-manager-installer.bin</strong> file by using below command after replacing your <strong>Cloudera Paywall Credentials</strong></p>
</li>
</ul>
</div>
<div class="listingblock data-line-576">
<div class="content">
<pre>wget https://&lt;user_name&gt;:&lt;password&gt;@archive.cloudera.com/p/cm7/7.9.5/cloudera-manager-installer.bin</pre>
</div>
</div>
<div class="ulist data-line-580">
<ul>
<li class="data-line-580">
<p><strong>Step 6:</strong> Add the Executable permission to above downloaded file.</p>
</li>
</ul>
</div>
<div class="listingblock data-line-582">
<div class="content">
<pre>chmod u+x cloudera-manager-installer.bin</pre>
</div>
</div>
</div>
<div class="sect2 data-line-585">
<h3 id="_install_cloudera_manager_with_embedded_database">Install <strong>Cloudera Manager</strong> with <strong>Embedded Database</strong>.</h3>
<div class="ulist data-line-587">
<ul>
<li class="data-line-587">
<p><strong>Step 1:</strong> Navigate to <strong>/tmp</strong> directory.</p>
</li>
</ul>
</div>
<div class="listingblock data-line-589">
<div class="content">
<pre>cd /tmp/</pre>
</div>
</div>
<div class="ulist data-line-592">
<ul>
<li class="data-line-592">
<p><strong>Step 2:</strong> Execute the bin file using below command to install.</p>
</li>
</ul>
</div>
<div class="listingblock data-line-594">
<div class="content">
<pre>./cloudera-manager-installer.bin</pre>
</div>
</div>
<div class="paragraph data-line-598">
<p><strong>1:</strong> The <strong>Cloudera Manager Read Me</strong> page appears.</p>
</div>
<div class="imageblock data-line-600">
<div class="content">
<img src="images/cdp-quick-start-deployment-cm-installer.png" alt="cdp quick start deployment cm installer">
</div>
</div>
<div class="paragraph data-line-602">
<p>Click <strong>Next</strong></p>
</div>
<div class="paragraph data-line-604">
<p><strong>2:</strong> The <strong>Cloudera Standard License</strong> page appears.</p>
</div>
<div class="imageblock data-line-606">
<div class="content">
<img src="images/cdp-quick-start-deployment-streams-cm-installer-license.png" alt="cdp quick start deployment streams cm installer license">
</div>
</div>
<div class="paragraph data-line-608">
<p>Click <strong>Next</strong> to accept the license agreement</p>
</div>
<div class="paragraph data-line-610">
<p><strong>3:</strong> The installer starts and does the following:</p>
</div>
<div class="ulist data-line-612">
<ul>
<li class="data-line-612">
<p><strong>A:</strong> Installs Oracle JDK:</p>
</li>
</ul>
</div>
<div class="imageblock data-line-614">
<div class="content">
<img src="images/cdp-quick-start-deployment-streams-install-jdk.png" alt="cdp quick start deployment streams install jdk">
</div>
</div>
<div class="ulist data-line-616">
<ul>
<li class="data-line-616">
<p><strong>B:</strong> Installs the Cloudera Manager Server.</p>
</li>
</ul>
</div>
<div class="imageblock data-line-618">
<div class="content">
<img src="images/cdp-quick-start-deployment-streams-install-cm-server.png" alt="cdp quick start deployment streams install cm server">
</div>
</div>
<div class="ulist data-line-620">
<ul>
<li class="data-line-620">
<p><strong>C:</strong> Installs the embedded PostgreSQL packages and starts the database and Cloudera Manager Server.</p>
</li>
</ul>
</div>
<div class="imageblock data-line-622">
<div class="content">
<img src="images/cdp-quick-start-deployment-streams-install-db.png" alt="cdp quick start deployment streams install db">
</div>
</div>
<div class="listingblock data-line-625">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">NOTE:
If the installation is interrupted, run the following command on the Cloudera Manager Server host before you retry the installation:</code></pre>
</div>
</div>
<div class="listingblock data-line-629">
<div class="content">
<pre>sudo /usr/share/cmf/uninstall-cloudera-manager.sh</pre>
</div>
</div>
<div class="listingblock data-line-632">
<div class="content">
<pre>The log files for the installer are stored in /var/log/cloudera-manager-installer/.</pre>
</div>
</div>
<div class="paragraph data-line-635">
<p><strong>4:</strong> Exit the installer:</p>
</div>
<div class="ulist data-line-637">
<ul>
<li class="data-line-637">
<p><strong>A:</strong> When the installation completes, the complete URL for the Cloudera Manager Admin Console displays, including the default port number: 7180.</p>
<div class="literalblock data-line-639">
<div class="content">
<pre>Make a note of this URL or take a screen capture as you will need it for the next task.</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="imageblock data-line-641">
<div class="content">
<img src="images/cdp-quick-start-deployment-streams-install-cm-url.png" alt="cdp quick start deployment streams install cm url">
</div>
</div>
<div class="ulist data-line-642">
<ul>
<li class="data-line-642">
<p><strong>B:</strong> Click <strong>Ok</strong></p>
<div class="literalblock data-line-644">
<div class="content">
<pre>The success message appears</pre>
</div>
</div>
</li>
<li class="data-line-646">
<p><strong>C:</strong> Click OK to exit the installer.</p>
</li>
</ul>
</div>
<div class="imageblock data-line-648">
<div class="content">
<img src="images/cdp-quick-start-deployment-streams-install-finish.png" alt="cdp quick start deployment streams install finish">
</div>
</div>
</div>
<div class="sect2 data-line-650">
<h3 id="_setup_private_cloud_base_cluster">Setup Private Cloud Base Cluster</h3>
<div class="paragraph data-line-652">
<p>In this step, we will setup the Base cluster which will serve as the DataLake for the CDP Data Services that need the SDK capabilities for the cluster wide features like lineage, governance, security etc..,</p>
</div>
<div class="sect3 data-line-654">
<h4 id="_upload_license_file">Upload license file</h4>
<div class="ulist data-line-656">
<ul>
<li class="data-line-656">
<p>Once the cloudera-manager(CM) installation is completed, open the endpoint shown in the previous steps, i.e., <a href="http://AWS_Elastic_IP_for_Cloudera_Manager:7180" class="undefined" data-href="http://AWS_Elastic_IP_for_Cloudera_Manager:7180">http://AWS_Elastic_IP_for_Cloudera_Manager:7180</a> and login to the CM using default credentials.</p>
</li>
</ul>
</div>
<div class="paragraph data-line-658">
<p><strong>Username</strong>: admin</p>
</div>
<div class="paragraph data-line-660">
<p><strong>Password</strong>: admin</p>
</div>
<div class="imageblock data-line-662">
<div class="content">
<img src="images/Base/cm_login.png" alt="cm login">
</div>
</div>
<div class="paragraph data-line-664">
<p>The <strong>Welcome to Cloudera Manager</strong> page appears.</p>
</div>
<div class="ulist data-line-666">
<ul>
<li class="data-line-666">
<p>Since you would have received the CDP license before, select <strong>Upload Cloudera Data Platform license</strong> and upload the downloaded .txt or .zip file with the license information. Click <strong>Continue</strong>.</p>
</li>
</ul>
</div>
<div class="imageblock data-line-668">
<div class="content">
<img src="images/Base/cdp_license.png" alt="cdp license">
</div>
</div>
<div class="paragraph data-line-670">
<p>The <strong>Add Private Cloud Base Cluster</strong> page appears. Next, we will enable AutoTLS for CM.</p>
</div>
<div class="imageblock data-line-672">
<div class="content">
<img src="images/Base/add_pvc_base_page.png" alt="add pvc base page">
</div>
</div>
</div>
<div class="sect3 data-line-674">
<h4 id="_install_cloudera_manager_agent">Install Cloudera-manager-agent</h4>
<div class="ulist data-line-676">
<ul>
<li class="data-line-676">
<p>As a prerequisite step to enabling AutoTLS, login to the base master node as root, and run the below command to install cloudera-manager-agent.</p>
</li>
</ul>
</div>
<div class="listingblock data-line-678">
<div class="content">
<pre>yum install cloudera-manager-agent -y</pre>
</div>
</div>
<div class="imageblock data-line-681">
<div class="content">
<img src="images/Base/cm_agent_install.png" alt="cm agent install">
</div>
</div>
<div class="imageblock data-line-683">
<div class="content">
<img src="images/Base/cm_agent_install_complete.png" alt="cm agent install complete">
</div>
</div>
<div class="ulist data-line-685">
<ul>
<li class="data-line-685">
<p>Once it is installed successfully, start and enable the <strong>cloudera-scm-agent</strong> service.</p>
</li>
</ul>
</div>
<div class="listingblock data-line-687">
<div class="content">
<pre>systemctl start cloudera-scm-agent &amp;&amp; systemctl enable cloudera-scm-agent</pre>
</div>
</div>
<div class="ulist data-line-691">
<ul>
<li class="data-line-691">
<p>Verify the same by running the below command. This should return the output stating the service is active and in running state.</p>
</li>
</ul>
</div>
<div class="listingblock data-line-693">
<div class="content">
<pre>systemctl status cloudera-scm-agent</pre>
</div>
</div>
<div class="imageblock data-line-696">
<div class="content">
<img src="images/Base/scm_agent_status.png" alt="scm agent status">
</div>
</div>
</div>
<div class="sect3 data-line-698">
<h4 id="_enable_auto_tls">Enable Auto-TLS</h4>
<div class="ulist data-line-700">
<ul>
<li class="data-line-700">
<p>Once the cloudera-scm-agent service is running successfully, switch to the Cloudera Manager screen on your browser and click on <strong>here to setup Enable AutoTLS</strong> on the <strong>Add Private Cloud Base Cluster</strong> page.</p>
</li>
</ul>
</div>
<div class="imageblock data-line-702">
<div class="content">
<img src="images/Base/auto_tls.png" alt="auto tls">
</div>
</div>
<div class="ulist data-line-704">
<ul>
<li class="data-line-704">
<p>Enter the values for the parameters as shown below.</p>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-all stretch data-line-706">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable TLS for</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All existing and future clusters</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SSH username</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">root</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Authentication method</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All hosts accept same private key</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Private Key</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Choose the private key created in the Base AMI setup section</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enter the passphrase</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enter the passphrase given at the time of key-pair creation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Confirm the passphrase</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enter the passphrase again</p></td>
</tr>
</tbody>
</table>
<div class="imageblock data-line-718">
<div class="content">
<img src="images/Base/auto_tls_param.png" alt="auto tls param">
</div>
</div>
<div class="paragraph data-line-720">
<p>Click <strong>Next</strong>.</p>
</div>
<div class="ulist data-line-722">
<ul>
<li class="data-line-722">
<p>You should see this page next if all the values are entered properly.</p>
</li>
</ul>
</div>
<div class="imageblock data-line-724">
<div class="content">
<img src="images/Base/tls_complete.png" alt="tls complete">
</div>
</div>
<div class="paragraph data-line-726">
<p>Click <strong>Finish</strong>.</p>
</div>
<div class="ulist data-line-728">
<ul>
<li class="data-line-728">
<p>Login to the base master host as root and run the below command as suggested in the previous screenshot.</p>
</li>
</ul>
</div>
<div class="listingblock data-line-730">
<div class="content">
<pre>systemctl restart cloudera-scm-server</pre>
</div>
</div>
<div class="ulist data-line-734">
<ul>
<li class="data-line-734">
<p>Run the below command to check the logs of cloudera-scm-server starting up. Wait until you see the <strong>Started Jetty server</strong> message on the screen.</p>
</li>
</ul>
</div>
<div class="listingblock data-line-736">
<div class="content">
<pre>tail -f /var/log/cloudera-scm-server/cloudera-scm-server.logscm-server.log</pre>
</div>
</div>
<div class="imageblock data-line-739">
<div class="content">
<img src="images/Base/jetty_started.png" alt="jetty started">
</div>
</div>
<div class="ulist data-line-741">
<ul>
<li class="data-line-741">
<p>Once you see this message on the logs, open the CM endpoint, <a href="http://AWS_Elastic_IP_for_Cloudera_Manager:7180" class="undefined" data-href="http://AWS_Elastic_IP_for_Cloudera_Manager:7180">http://AWS_Elastic_IP_for_Cloudera_Manager:7180</a>, in a new incognito window.</p>
</li>
<li class="data-line-743">
<p>The URL should get redirected to <strong>https</strong> at <strong>7183</strong> port. This means that the <strong>AutoTLS</strong> configuration is successful.</p>
</li>
</ul>
</div>
<div class="paragraph data-line-745">
<p>You might get a warning message on the browser related to the certificate. You can ignore the warning and visit the website as this is not a signed certificate.</p>
</div>
<div class="ulist data-line-747">
<ul>
<li class="data-line-747">
<p>Enter the default credentials and login. You should see AutoTLS enabled as shown in the image below.</p>
</li>
</ul>
</div>
<div class="imageblock data-line-749">
<div class="content">
<img src="images/Base/tls_enabled.png" alt="tls enabled">
</div>
</div>
<div class="ulist data-line-751">
<ul>
<li class="data-line-751">
<p>Click <strong>Continue</strong> and continue with the cluster setup wizard. The Cluster Basics section appears.</p>
</li>
</ul>
</div>
</div>
<div class="sect3 data-line-753">
<h4 id="_enable_ssl_on_embedded_db">Enable SSL On Embedded DB</h4>
<div class="ulist data-line-755">
<ul>
<li class="data-line-755">
<p>Login to the base master node.</p>
</li>
<li class="data-line-757">
<p>Stop Cloudera SCM server and Cloudera Embedded DB service. Please note that the order should not be changed. i.e., first the scm-server should be stopped and then the scm-server-db.</p>
</li>
</ul>
</div>
<div class="listingblock data-line-759">
<div class="content">
<pre>systemctl stop cloudera-scm-server
systemctl stop cloudera-scm-server-db</pre>
</div>
</div>
<div class="ulist data-line-764">
<ul>
<li class="data-line-764">
<p>Navigate to /var/lib/cloudera-scm-agent/agent-cert directory.</p>
</li>
</ul>
</div>
<div class="listingblock data-line-766">
<div class="content">
<pre>cd /var/lib/cloudera-scm-agent/agent-cert</pre>
</div>
</div>
<div class="ulist data-line-770">
<ul>
<li class="data-line-770">
<p>Get the password from the file <strong>cm-auto-host_key.pw</strong>. Note down this password in an editor.</p>
</li>
</ul>
</div>
<div class="listingblock data-line-772">
<div class="content">
<pre>cat cm-auto-host_key.pw</pre>
</div>
</div>
<div class="ulist data-line-776">
<ul>
<li class="data-line-776">
<p>We will use the host certificate for enabling SSL. Extract the host certificate from cm-auto-host_keystore.jks using keytool utility. Place the Base master FQDN in the placeholder.</p>
</li>
</ul>
</div>
<div class="listingblock data-line-779">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">/usr/java/jdk1.8.0_232-cloudera/jre/bin/keytool -export -alias &lt;Base Master FQDN&gt; -keystore \
cm-auto-host_keystore.jks -rfc -file cm.cert</code></pre>
</div>
</div>
<div class="paragraph data-line-784">
<p><strong>Ex:-</strong></p>
</div>
<div class="listingblock data-line-785">
<div class="content">
<pre>/usr/java/jdk1.8.0_232-cloudera/jre/bin/keytool -export -alias cdpbase.cdppvcds.com -keystore \
cm-auto-host_keystore.jks -rfc -file cm.cert</pre>
</div>
</div>
<div class="listingblock data-line-790">
<div class="content">
<pre>openssl rsa -in cm-auto-host_key.pem -out cm.key</pre>
</div>
</div>
<div class="ulist data-line-794">
<ul>
<li class="data-line-794">
<p>The above steps create a .cert and cm.key file in that location.</p>
</li>
</ul>
</div>
<div class="imageblock data-line-796">
<div class="content">
<img src="images/Base/cm_key_and_cm_cert.png" alt="cm key and cm cert">
</div>
</div>
<div class="ulist data-line-798">
<ul>
<li class="data-line-798">
<p>Copy those files to the folder <strong>/var/lib/cloudera-scm-server-db/data/</strong>.</p>
</li>
</ul>
</div>
<div class="listingblock data-line-800">
<div class="content">
<pre>cp /var/lib/cloudera-scm-agent/agent-cert/cm.cert /var/lib/cloudera-scm-server-db/data/
cp /var/lib/cloudera-scm-agent/agent-cert/cm.key /var/lib/cloudera-scm-server-db/data/</pre>
</div>
</div>
<div class="ulist data-line-806">
<ul>
<li class="data-line-806">
<p>Navigate to the folder /var/lib/cloudera-scm-server-db/data/ and change the owner:group to cloudera-scm:cloudera-scm with 600 permissions for <strong>cm.key</strong> file.</p>
</li>
</ul>
</div>
<div class="listingblock data-line-808">
<div class="content">
<pre>cd /var/lib/cloudera-scm-server-db/data
chown cloudera-scm:cloudera-scm cm.key
chmod 600 cm.key</pre>
</div>
</div>
<div class="ulist data-line-814">
<ul>
<li class="data-line-814">
<p>At the same location, <strong>/var/lib/cloudera-scm-server-db/data</strong>, edit the file <strong>postgresql.conf</strong> and change below parameters values and save the file.</p>
<div class="ulist data-line-815">
<ul>
<li class="data-line-815">
<p>ssl = on</p>
</li>
<li class="data-line-816">
<p>ssl_cert_file = 'cm.cert'</p>
</li>
<li class="data-line-817">
<p>ssl_key_file = 'cm.key'</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph data-line-819">
<p><strong>Ensure to uncomment these lines as they are commented out by default.</strong></p>
</div>
<div class="imageblock data-line-821">
<div class="content">
<img src="images/Base/postgres_conf.png" alt="postgres conf">
</div>
</div>
<div class="ulist data-line-823">
<ul>
<li class="data-line-823">
<p>Start the embedded DB and Cloudera SCM Server.</p>
</li>
</ul>
</div>
<div class="listingblock data-line-825">
<div class="content">
<pre>systemctl start cloudera-scm-server-db
systemctl start cloudera-scm-server</pre>
</div>
</div>
<div class="ulist data-line-830">
<ul>
<li class="data-line-830">
<p>Run the below command to check the logs of cloudera-scm-server starting up. Wait until you see the <strong>Started Jetty server</strong> message on the screen.</p>
</li>
</ul>
</div>
<div class="listingblock data-line-832">
<div class="content">
<pre>tail -f /var/log/cloudera-scm-server/cloudera-scm-server.log</pre>
</div>
</div>
<div class="ulist data-line-836">
<ul>
<li class="data-line-836">
<p>The Cloudera Manager should come up.</p>
</li>
</ul>
</div>
</div>
<div class="sect3 data-line-838">
<h4 id="_kerberos_integration">Kerberos Integration</h4>
<div class="ulist data-line-840">
<ul>
<li class="data-line-840">
<p>Before proceeding further with KDC setup, we need to ensure that the changes to krb5.conf related to default cache is not reversed. View the contents of the file <strong>/etc/krb5.conf</strong> and check whether the property <strong>default_ccache_name</strong> is commented out. If not, then open the file and comment it.</p>
</li>
</ul>
</div>
<div class="listingblock data-line-843">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">#default_ccache_name = KEYRING:persistent:%{uid}</code></pre>
</div>
</div>
<div class="imageblock data-line-847">
<div class="content">
<img src="images/ipa_kerb_keyring.png" alt="ipa kerb keyring">
</div>
</div>
<div class="paragraph data-line-849">
<p><strong>If you have made any changes, only then run the below commands to restart all the IPA services. If not, skip to the next step.</strong></p>
</div>
<div class="listingblock data-line-851">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">    ipactl stop
    ipactl start</code></pre>
</div>
</div>
<div class="ulist data-line-856">
<ul>
<li class="data-line-856">
<p>Login to Cloudera Manager after enabling SSL on embedded DB.</p>
</li>
<li class="data-line-858">
<p>In the left pane, click on <strong>Administration</strong> and then on <strong>Security</strong>.</p>
</li>
</ul>
</div>
<div class="imageblock data-line-860">
<div class="content">
<img src="images/Base/admin_to_security.png" alt="admin to security">
</div>
</div>
<div class="ulist data-line-862">
<ul>
<li class="data-line-862">
<p>Click on <strong>Kerberos credentials</strong> and then click on <strong>Set up KDC for this Cloudera Manager</strong>.</p>
</li>
</ul>
</div>
<div class="imageblock data-line-864">
<div class="content">
<img src="images/Base/kerb_creds.png" alt="kerb creds">
</div>
</div>
<div class="ulist data-line-866">
<ul>
<li class="data-line-866">
<p>On the first page enter details as below and click continue.</p>
</li>
</ul>
</div>
<div class="imageblock data-line-868">
<div class="content">
<img src="images/Base/kerb_setup_1.1.png" alt="kerb setup 1.1">
</div>
</div>
<div class="ulist data-line-870">
<ul>
<li class="data-line-870">
<p>Enable <strong>Manage krb5.conf through Cloudera Manager</strong> option.</p>
</li>
</ul>
</div>
<div class="imageblock data-line-872">
<div class="content">
<img src="images/Base/kerb_setup_2.png" alt="kerb setup 2">
</div>
</div>
<div class="ulist data-line-874">
<ul>
<li class="data-line-874">
<p>Next, enter the details as per the configuration of FreeIPA you did before. i.e., provide the domain and password of <strong>admin</strong> user configured earlier in the FreeIPA setup.</p>
</li>
</ul>
</div>
<div class="paragraph data-line-876">
<p><strong>Enter the REALM portion of the principal in upper-case only to conform to Kerberos convention.</strong></p>
</div>
<div class="imageblock data-line-878">
<div class="content">
<img src="images/Base/kerb_setup_3.1.png" alt="kerb setup 3.1">
</div>
</div>
<div class="ulist data-line-880">
<ul>
<li class="data-line-880">
<p>KDC Account manager credentials should get imported successfully as shown below.</p>
</li>
</ul>
</div>
<div class="imageblock data-line-882">
<div class="content">
<img src="images/Base/kerb_setup_4.png" alt="kerb setup 4">
</div>
</div>
</div>
<div class="sect3 data-line-884">
<h4 id="_ldap_integration">LDAP Integration</h4>
<div class="ulist data-line-886">
<ul>
<li class="data-line-886">
<p>From Cloudera Manager, navigate to <strong>Administration&#8594;Settings</strong>.</p>
</li>
</ul>
</div>
<div class="imageblock data-line-888">
<div class="content">
<img src="images/Base/admin_settings.png" alt="admin settings">
</div>
</div>
<div class="ulist data-line-890">
<ul>
<li class="data-line-890">
<p>In the filter section, click on <strong>External Authentication</strong>.</p>
</li>
</ul>
</div>
<div class="imageblock data-line-892">
<div class="content">
<img src="images/Base/ldap_ext_auth.png" alt="ldap ext auth">
</div>
</div>
<div class="ulist data-line-894">
<ul>
<li class="data-line-894">
<p>Enter details as per the below images.</p>
</li>
</ul>
</div>
<div class="imageblock data-line-896">
<div class="content">
<img src="images/Base/ldap_config_1.png" alt="ldap config 1">
</div>
</div>
<div class="ulist data-line-898">
<ul>
<li class="data-line-898">
<p>LDAP URL</p>
</li>
</ul>
</div>
<div class="listingblock data-line-900">
<div class="content">
<pre>ldap://&lt;ipaserver_fqdn&gt;&gt;:389/

Ex:- ldap://ipaserver.cdppvcds.com:389/</pre>
</div>
</div>
<div class="ulist data-line-907">
<ul>
<li class="data-line-907">
<p>LDAP Bind User Distinguished Name</p>
</li>
</ul>
</div>
<div class="listingblock data-line-909">
<div class="content">
<pre>uid=admin,cn=users,cn=accounts,dc=&lt;domain&gt;,dc=com

Ex:- uid=admin,cn=users,cn=accounts,dc=cdppvcds,dc=com</pre>
</div>
</div>
<div class="ulist data-line-915">
<ul>
<li class="data-line-915">
<p>LDAP Bind User Distinguished Name for monitoring</p>
</li>
</ul>
</div>
<div class="listingblock data-line-917">
<div class="content">
<pre>uid=admin,cn=users,cn=accounts,dc=&lt;domain&gt;,dc=com

Ex:- uid=admin,cn=users,cn=accounts,dc=cdppvcds,dc=com</pre>
</div>
</div>
<div class="imageblock data-line-923">
<div class="content">
<img src="images/Base/ldap_config_2.png" alt="ldap config 2">
</div>
</div>
<div class="ulist data-line-925">
<ul>
<li class="data-line-925">
<p>LDAP User Search filter</p>
</li>
</ul>
</div>
<div class="listingblock data-line-927">
<div class="content">
<pre>(&amp;(uid={0})(objectClass=person))</pre>
</div>
</div>
<div class="ulist data-line-931">
<ul>
<li class="data-line-931">
<p>LDAP User Search Base</p>
</li>
</ul>
</div>
<div class="listingblock data-line-933">
<div class="content">
<pre>cn=users,cn=accounts,dc=&lt;domain&gt;,dc=com
Ex:- cn=users,cn=accounts,dc=pvcbase,dc=com</pre>
</div>
</div>
<div class="ulist data-line-938">
<ul>
<li class="data-line-938">
<p>LDAP Group Search filter</p>
</li>
</ul>
</div>
<div class="listingblock data-line-940">
<div class="content">
<pre>(&amp;(member={1})(objectClass=posixgroup))</pre>
</div>
</div>
<div class="ulist data-line-944">
<ul>
<li class="data-line-944">
<p>LDAP Group Search Base</p>
</li>
</ul>
</div>
<div class="listingblock data-line-946">
<div class="content">
<pre>cn=groups,cn=accounts,dc=&lt;domain&gt;,dc=com
Ex:- cn=groups,cn=accounts,dc=pvcbase,dc=com</pre>
</div>
</div>
<div class="ulist data-line-951">
<ul>
<li class="data-line-951">
<p>Click Save.</p>
</li>
</ul>
</div>
</div>
<div class="sect3 data-line-953">
<h4 id="_add_hosts_to_cloudera_managaer">Add hosts to Cloudera Managaer</h4>
<div class="ulist data-line-955">
<ul>
<li class="data-line-955">
<p>Click on Add a new cluster.</p>
</li>
<li class="data-line-957">
<p>Enter a name for the cluster and click Continue.</p>
</li>
</ul>
</div>
<div class="imageblock data-line-959">
<div class="content">
<img src="images/Base/cluster_setup.png" alt="cluster setup">
</div>
</div>
<div class="ulist data-line-961">
<ul>
<li class="data-line-961">
<p>Enter the cluster host names or IP addresses in the Hostnames field. Click Search.</p>
</li>
</ul>
</div>
<div class="imageblock data-line-963">
<div class="content">
<img src="images/Base/specify_hosts_new.png" alt="specify hosts new">
</div>
</div>
<div class="ulist data-line-965">
<ul>
<li class="data-line-965">
<p>Cloudera Manager discovers the hosts.</p>
</li>
</ul>
</div>
<div class="imageblock data-line-967">
<div class="content">
<img src="images/Base/hosts_search.png" alt="hosts search">
</div>
</div>
<div class="ulist data-line-969">
<ul>
<li class="data-line-969">
<p>Verify host entries, deselect any that you do not want to install services on, and click Continue.
The Select Repository section appears.</p>
</li>
<li class="data-line-972">
<p>Select Custom Repository option and point to 7.9.5. Refer to the below screenshot.</p>
</li>
</ul>
</div>
<div class="imageblock data-line-974">
<div class="content">
<img src="images/Base/custom_repo.png" alt="custom repo">
</div>
</div>
<div class="ulist data-line-976">
<ul>
<li class="data-line-976">
<p>Select Install a Cloudera-provided version of OpenJDK.</p>
</li>
</ul>
</div>
<div class="imageblock data-line-978">
<div class="content">
<img src="images/Base/base_jdk.png" alt="base jdk">
</div>
</div>
<div class="ulist data-line-980">
<ul>
<li class="data-line-980">
<p>Click Continue. The Enter Login Credentials section appears.</p>
</li>
<li class="data-line-982">
<p>On the <strong>Enter Login Credentials</strong> page, select the SSH Username and provide the private key generated in <a href="#Preliminary_Work">Preliminary Work</a> section in Step1. Also, enter the passphrase entered while generating the key-pair.</p>
</li>
</ul>
</div>
<div class="imageblock data-line-984">
<div class="content">
<img src="images/ECS/enter_login_creds.png" alt="enter login creds">
</div>
</div>
<div class="ulist data-line-986">
<ul>
<li class="data-line-986">
<p>The Install Agents section appears showing the progress of the installation.</p>
</li>
</ul>
</div>
<div class="imageblock data-line-988">
<div class="content">
<img src="images/Base/install_agents.png" alt="install agents">
</div>
</div>
<div class="ulist data-line-990">
<ul>
<li class="data-line-990">
<p>After the agents are installed, the <strong>Install Parcels</strong> section appears showing the progress of the parcel installation.</p>
</li>
</ul>
</div>
<div class="imageblock data-line-992">
<div class="content">
<img src="images/Base/install_parcels.png" alt="install parcels">
</div>
</div>
<div class="ulist data-line-994">
<ul>
<li class="data-line-994">
<p>After the parcels are installed the <strong>Inspect Cluster</strong> section appears.</p>
</li>
</ul>
</div>
<div class="imageblock data-line-996">
<div class="content">
<img src="images/Base/inspect_cluster.png" alt="inspect cluster">
</div>
</div>
<div class="ulist data-line-998">
<ul>
<li class="data-line-998">
<p>Do the following:</p>
<div class="olist loweralpha data-line-999">
<ol class="loweralpha" type="a">
<li class="data-line-999">
<p>Click <strong>Inspect Network Performance</strong>.</p>
<div class="ulist data-line-1000">
<ul>
<li class="data-line-1000">
<p>After the network inspector completes, click Show Inspector Results to view the results in a new tab.
Address any reported issues, and click Run Again.</p>
</li>
</ul>
</div>
</li>
<li class="data-line-1003">
<p>Click <strong>Inspect Hosts</strong>.</p>
<div class="ulist data-line-1004">
<ul>
<li class="data-line-1004">
<p>After the host inspector completes, click Show Inspector Results to view the results in a new tab.
Address any reported issues, and click Run Again.</p>
</li>
</ul>
</div>
</li>
<li class="data-line-1007">
<p>Both the inspection tests should run successfully.</p>
</li>
</ol>
</div>
</li>
</ul>
</div>
<div class="imageblock data-line-1009">
<div class="content">
<img src="images/Base/green_inspect.png" alt="green inspect">
</div>
</div>
<div class="ulist data-line-1011">
<ul>
<li class="data-line-1011">
<p>Click <strong>Continue</strong>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3 data-line-1013">
<h4 id="_create_base_clusterdatalake_cluster_for_ecs">Create Base Cluster(Datalake cluster for ECS)</h4>
<div class="ulist data-line-1015">
<ul>
<li class="data-line-1015">
<p>The <strong>Add Cluster - Configuration</strong> page appears. Click on <strong>Custom Services</strong>.</p>
</li>
</ul>
</div>
<div class="imageblock data-line-1017">
<div class="content">
<img src="images/Base_cluster_setup/custom_services.png" alt="custom services">
</div>
</div>
<div class="ulist data-line-1019">
<ul>
<li class="data-line-1019">
<p>Select the below Cloudera Services to be installed on the cluster and click <strong>Continue</strong>.</p>
<div class="ulist data-line-1021">
<ul>
<li class="data-line-1021">
<p>Atlas</p>
</li>
<li class="data-line-1022">
<p>Solr</p>
</li>
<li class="data-line-1023">
<p>HBase</p>
</li>
<li class="data-line-1024">
<p>HDFS</p>
</li>
<li class="data-line-1025">
<p>Hive (For <strong>Hive Metastore Server</strong> only)</p>
</li>
<li class="data-line-1026">
<p>Hive_on_Tez (For <strong>HiveServer2</strong>)</p>
</li>
<li class="data-line-1027">
<p>Kafka</p>
</li>
<li class="data-line-1028">
<p>Ozone</p>
</li>
<li class="data-line-1029">
<p>Ranger</p>
</li>
<li class="data-line-1030">
<p>Tez</p>
</li>
<li class="data-line-1031">
<p>YARN</p>
</li>
<li class="data-line-1032">
<p>Zookeeper</p>
</li>
</ul>
</div>
</li>
<li class="data-line-1034">
<p>Next, you need to assign hosts to different roles across all the selected services. Use the below table as a reference to assign the roles.</p>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-all stretch data-line-1037">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Role Instance</th>
<th class="tableblock halign-left valign-top">Host</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Kafka</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Kafka Broker</strong> - base-master</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Atlas</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Atlas Server</strong> - base-master</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Core Configuration</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Gateway</strong> -  base-master</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>HBase</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">* <strong>Master</strong>  -  base-master</p>
<p class="tableblock">                              * <strong>RegionServer</strong> - base-master</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>HDFS</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">* <strong>NameNode</strong>  - base-master</p>
<p class="tableblock">                              * <strong>DataNode</strong>    - base-worker1, base-worker2, base-worker3</p>
<p class="tableblock">                              * <strong>NodeManager</strong> - base-worker1, base-worker2, base-worker3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Hive</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">* <strong>Gateway</strong> - base-worker1, base-worker2, base-worker3</p>
<p class="tableblock">                              * <strong>Metastore Server</strong> - base-master</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Hive on Tez</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">* <strong>Gateway</strong>  - base-worker1, base-worker2, base-worker3</p>
<p class="tableblock">                              * <strong>HiveServer2</strong> - base-master</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Cloudera Management Service</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">* <strong>Service Monitor</strong> - base-master</p>
<p class="tableblock">                                * <strong>Host Monitor</strong> - base-master</p>
<p class="tableblock">                                * <strong>Reports Manager</strong> - base-master</p>
<p class="tableblock">                                * <strong>Event Server</strong> - base-master</p>
<p class="tableblock">                                * <strong>Alert Publisher</strong> - base-master</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Ozone</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">* <strong>Storage Container Manager</strong> - base-master</p>
<p class="tableblock">                                * <strong>Ozone Manager</strong> - base-master</p>
<p class="tableblock">                                * <strong>Ozone Recon</strong> - base-master</p>
<p class="tableblock">                                * <strong>S3 Gateway</strong> - base-master</p>
<p class="tableblock">                                * <strong>Gateway</strong> - base-worker1, base-worker2, base-worker3</p>
<p class="tableblock">                                * <strong>Ozone DataNode</strong> - base-worker1, base-worker2, base-worker3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Ranger</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">* <strong>Ranger Admin</strong> -  base-master</p>
<p class="tableblock">                                * <strong>Usersync</strong> -  base-master</p>
<p class="tableblock">                                * <strong>Ranger Tagsync</strong> - base-master</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Solr</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">* <strong>Solr Server</strong> -  base-master</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Tez</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">* <strong>Gateway</strong> - base-master</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>YARN</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">* <strong>ResourceManager</strong> - base-master</p>
<p class="tableblock">                                * <strong>JobHistory Server</strong> - base-master</p>
<p class="tableblock">                                * <strong>NodeManager</strong> - base-worker1, base-worker2, base-worker3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>ZooKeeper</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">* <strong>Server</strong> - base-master</p></td>
</tr>
</tbody>
</table>
<div class="ulist data-line-1106">
<ul>
<li class="data-line-1106">
<p>Click <strong>Continue</strong>.</p>
</li>
<li class="data-line-1108">
<p>On the <strong>Setup Database</strong> page, select <strong>Use Embedded Database</strong>.</p>
</li>
</ul>
</div>
<div class="imageblock data-line-1110">
<div class="content">
<img src="images/Base_cluster_setup/emb_db.png" alt="emb db">
</div>
</div>
<div class="ulist data-line-1112">
<ul>
<li class="data-line-1112">
<p>Click on <strong>Test Connection</strong>.</p>
</li>
</ul>
</div>
<div class="imageblock data-line-1114">
<div class="content">
<img src="images/Base_cluster_setup/test_con.png" alt="test con">
</div>
</div>
<div class="ulist data-line-1116">
<ul>
<li class="data-line-1116">
<p>Once the <strong>Test Connection</strong> succeeds, click on <strong>Continue</strong>.</p>
</li>
<li class="data-line-1118">
<p>The <strong>Enter Required Parameters</strong> page appears.</p>
<div class="ulist data-line-1120">
<ul>
<li class="data-line-1120">
<p>Enter a suitable name for <strong>Ozone Service ID</strong>.</p>
</li>
<li class="data-line-1122">
<p>For all the remaining parameters, set a common password so that it becomes easier while using those services.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph data-line-1124">
<p><strong>This password must have 1 lowercase, 1 uppercase, and 1 numeric value. Failing to adhere this, the final step in the cluster setup would fail.</strong></p>
</div>
<div class="imageblock data-line-1126">
<div class="content">
<img src="images/Base_cluster_setup/passwd.png" alt="passwd">
</div>
</div>
<div class="ulist data-line-1128">
<ul>
<li class="data-line-1128">
<p>Click <strong>Continue</strong>.</p>
</li>
<li class="data-line-1130">
<p>The <strong>Review Changes</strong> page appears. Set a password for <strong>Atlas</strong>. You can set it to the same value set for <strong>Ranger</strong> above.</p>
</li>
</ul>
</div>
<div class="imageblock data-line-1132">
<div class="content">
<img src="images/Base_cluster_setup/atlas_passwd.png" alt="atlas passwd">
</div>
</div>
<div class="ulist data-line-1134">
<ul>
<li class="data-line-1134">
<p>Scroll down and update the <strong>HDFS disks</strong> configuration according to the below.</p>
<div class="ulist data-line-1135">
<ul>
<li class="data-line-1135">
<p>DataNode Data Directory:</p>
</li>
<li class="data-line-1136">
<p>NameNode Data Directories:</p>
</li>
<li class="data-line-1137">
<p>HDFS Checkpoint Directories:</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="imageblock data-line-1139">
<div class="content">
<img src="images/Base_cluster_setup/hdfs_disks.png" alt="hdfs disks">
</div>
</div>
<div class="ulist data-line-1141">
<ul>
<li class="data-line-1141">
<p>Click <strong>Continue</strong>.</p>
</li>
<li class="data-line-1143">
<p>On the next page, <strong>Configure Kerberos</strong>, <strong>enable kerberos</strong> and <strong>use default kerberos principals</strong>.</p>
</li>
</ul>
</div>
<div class="imageblock data-line-1145">
<div class="content">
<img src="images/Base_cluster_setup/enable_kerberos.png" alt="enable kerberos">
</div>
</div>
<div class="imageblock data-line-1147">
<div class="content">
<img src="images/Base_cluster_setup/default_kerb.png" alt="default kerb">
</div>
</div>
<div class="ulist data-line-1149">
<ul>
<li class="data-line-1149">
<p>A few set of commands are run in background. Wait for them to get executed successfully. Once done, click <strong>Continue</strong>.</p>
</li>
</ul>
</div>
<div class="imageblock data-line-1151">
<div class="content">
<img src="images/Base_cluster_setup/cmd_1.1.png" alt="cmd 1.1">
</div>
</div>
<div class="ulist data-line-1153">
<ul>
<li class="data-line-1153">
<p>Next, all the Cloudera services would get started and their prerequisite operations would also be run. These processes will run in a combination of serial and parallel processes. Wait for them to complete.</p>
</li>
<li class="data-line-1155">
<p>Once completed, you will see a <strong>Green</strong> tick next to all the steps.</p>
</li>
</ul>
</div>
<div class="imageblock data-line-1157">
<div class="content">
<img src="images/Base_cluster_setup/final_clust_setup_3.png" alt="final clust setup 3">
</div>
</div>
<div class="ulist data-line-1159">
<ul>
<li class="data-line-1159">
<p>Click <strong>Continue</strong>.</p>
</li>
<li class="data-line-1161">
<p>You will see a <strong>Summary</strong> page</p>
</li>
</ul>
</div>
<div class="imageblock data-line-1163">
<div class="content">
<img src="images/Base_cluster_setup/clust_setup_summary.png" alt="clust setup summary">
</div>
</div>
<div class="ulist data-line-1165">
<ul>
<li class="data-line-1165">
<p>Click <strong>FInish</strong>.</p>
</li>
<li class="data-line-1167">
<p>This will navigate to the main page where you can see all the services installed.</p>
</li>
<li class="data-line-1169">
<p>All the services should be in <strong>Healthy</strong> state. If there are any instances in <strong>Bad Health</strong>, troubleshoot the same and fix it.</p>
</li>
<li class="data-line-1171">
<p>This completes the <strong>CDP Private Cloud Base</strong> cluster setup.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1 data-line-1180">
<h2 id="_private_cloud_data_services_setup">Private Cloud Data Services Setup</h2>
<div class="sectionbody">
<div class="sect2 data-line-1182">
<h3 id="_prepare_ecs_nodes">Prepare ECS Nodes</h3>
<div class="ulist data-line-1184">
<ul>
<li class="data-line-1184">
<p>Start the EC2 instances designated for the ECS cluster created in the step <a href="#Cluster_Hosts">Add all the machines to the DNS server</a> in the <a href="#Preliminary_Work">Preliminary Work</a> section. Refer to the <a href="#Hardware_Table">Hardware</a> table for machine type , EBS Volume Size, and associated Security Group.</p>
</li>
<li class="data-line-1186">
<p>On each of the ECS hosts, create three partitions of the attached 2T EBS volume (non-root) and mount those partitions as below.</p>
</li>
</ul>
</div>
<div class="imageblock data-line-1188">
<div class="content">
<img src="images/lsblk_ecs.png" alt="lsblk ecs">
</div>
</div>
<div class="ulist data-line-1190">
<ul>
<li class="data-line-1190">
<p>Allocate an Elastic IP on AWS and associate it with the ECS Master EC2 instance.</p>
</li>
</ul>
</div>
</div>
<div class="sect2 data-line-1192">
<h3 id="_install_ecs">Install ECS</h3>
<div class="ulist data-line-1194">
<ul>
<li class="data-line-1194">
<p>In Cloudera Manager, click Data Services in the left menu.</p>
</li>
</ul>
</div>
<div class="imageblock data-line-1196">
<div class="content">
<img src="images/ECS/CM_data_svcs.png" alt="CM data svcs">
</div>
</div>
<div class="ulist data-line-1198">
<ul>
<li class="data-line-1198">
<p>The <strong>Add Private Cloud Containerized Cluster</strong> page appears. Click Continue.</p>
</li>
</ul>
</div>
<div class="imageblock data-line-1200">
<div class="content">
<img src="images/ECS/add_priv_containerized.png" alt="add priv containerized">
</div>
</div>
<div class="paragraph data-line-1202">
<p><em>Alternatively, you can also click Add &gt; Add Cluster at the top right in Cloudera Manager, then select Private Cloud Containerized Cluster as the cluster type.</em></p>
</div>
<div class="imageblock data-line-1204">
<div class="content">
<img src="images/ECS/add_cluster.png" alt="add cluster">
</div>
</div>
<div class="imageblock data-line-1206">
<div class="content">
<img src="images/ECS/sel_clust_type_alt.png" alt="sel clust type alt">
</div>
</div>
<div class="ulist data-line-1208">
<ul>
<li class="data-line-1208">
<p>On the <strong>Getting Started</strong> page of the installation wizard, select <strong>Air Gapped</strong> as the Install Method and select your local repo URL in Custom Repository Section. This local repo is from the step <a href="#Create_Local_Mirror">Create Local mirror for ECS bits</a> where httpd is installed on an EC2 instance to download the ECS images.</p>
</li>
</ul>
</div>
<div class="imageblock data-line-1210">
<div class="content">
<img src="images/ECS/air_gapped.png" alt="air gapped">
</div>
</div>
<div class="ulist data-line-1212">
<ul>
<li class="data-line-1212">
<p>Once you see the correct version at the bottom of the page as shown in the above screenshot, Click <strong>Continue</strong>.</p>
</li>
<li class="data-line-1214">
<p>In the <strong>Cluster Basics</strong> page, type a name for the Private Cloud cluster that you want to create in the Cluster Name field. From the Base Cluster drop-down list, select the cluster that has the storage and SDX services that you want this new Private Cloud Data Services instance to connect with. Click Continue.</p>
</li>
</ul>
</div>
<div class="imageblock data-line-1216">
<div class="content">
<img src="images/ECS/base_for_ECS.png" alt="base for ECS">
</div>
</div>
<div class="ulist data-line-1218">
<ul>
<li class="data-line-1218">
<p>In the <strong>Specify Hosts</strong> page, provide a list of available ECS hosts.</p>
</li>
</ul>
</div>
<div class="imageblock data-line-1220">
<div class="content">
<img src="images/ECS/add_ecs_hosts.png" alt="add ecs hosts">
</div>
</div>
<div class="ulist data-line-1222">
<ul>
<li class="data-line-1222">
<p>In the <strong>Select JDK</strong> page, select <strong>Install a Cloudera-provided version of OpenJDK</strong> .</p>
</li>
</ul>
</div>
<div class="imageblock data-line-1224">
<div class="content">
<img src="images/ECS/openjdk.png" alt="openjdk">
</div>
</div>
<div class="ulist data-line-1226">
<ul>
<li class="data-line-1226">
<p>On the <strong>Enter Login Credentials</strong> page, select the SSH Username and provide the private key generated in <a href="#Preliminary_Work">Preliminary Work</a> section in Step1. Also, enter the passphrase entered while generating the key-pair.</p>
</li>
</ul>
</div>
<div class="imageblock data-line-1228">
<div class="content">
<img src="images/ECS/enter_login_creds.png" alt="enter login creds">
</div>
</div>
<div class="ulist data-line-1230">
<ul>
<li class="data-line-1230">
<p>The Install Agents page appears with the progress bar showing the components getting installed like openjdk. Once it is complete, click <strong>Continue</strong>.</p>
</li>
</ul>
</div>
<div class="imageblock data-line-1232">
<div class="content">
<img src="images/ECS/install_agent.png" alt="install agent">
</div>
</div>
<div class="ulist data-line-1234">
<ul>
<li class="data-line-1234">
<p>Next on the <strong>Assign Roles</strong> page, ensure that the roles assignment for your new Private Cloud Containerized cluster is as follows.</p>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-all stretch data-line-1237">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Role</th>
<th class="tableblock halign-left valign-top">ECS Host</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Docker Server</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All ECS Hosts (i.e., ECS master and worker nodes)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ECS Server</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ECS Master only</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ECS Agent</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ECS Workers only</p></td>
</tr>
</tbody>
</table>
<div class="imageblock data-line-1246">
<div class="content">
<img src="images/ECS/assign_ECS_roles.png" alt="assign ECS roles">
</div>
</div>
<div class="ulist data-line-1248">
<ul>
<li class="data-line-1248">
<p>On the <strong>Configure a Docker Repository</strong> page, select <strong>Use an embedded Docker repository</strong> option.</p>
</li>
</ul>
</div>
<div class="imageblock data-line-1250">
<div class="content">
<img src="images/ECS/embedded_docker.png" alt="embedded docker">
</div>
</div>
<div class="ulist data-line-1252">
<ul>
<li class="data-line-1252">
<p>After choosing the embedded docker option, select <strong>default</strong>.</p>
</li>
</ul>
</div>
<div class="imageblock data-line-1254">
<div class="content">
<img src="images/ECS/default_docker.png" alt="default docker">
</div>
</div>
<div class="ulist data-line-1256">
<ul>
<li class="data-line-1256">
<p>On the <strong>Configure Data Services</strong> page, modify the storage related parameters as shown below.</p>
</li>
</ul>
</div>
<div class="imageblock data-line-1258">
<div class="content">
<img src="images/ECS/ecs_volume_config.png" alt="ecs volume config">
</div>
</div>
<div class="ulist data-line-1260">
<ul>
<li class="data-line-1260">
<p>On the <strong>Configure Databases page</strong>, select <strong>Create embedded databases</strong> with default values. Click <strong>Continue</strong>.</p>
</li>
</ul>
</div>
<div class="imageblock data-line-1262">
<div class="content">
<img src="images/ECS/configure_ecs_db.png" alt="configure ecs db">
</div>
</div>
<div class="ulist data-line-1264">
<ul>
<li class="data-line-1264">
<p>On the <strong>Install Parcels</strong> page, the selected parcels are downloaded and installed on the host cluster. Click <strong>Continue</strong>.</p>
</li>
</ul>
</div>
<div class="imageblock data-line-1266">
<div class="content">
<img src="images/ECS/install_parcels.png" alt="install parcels">
</div>
</div>
<div class="ulist data-line-1268">
<ul>
<li class="data-line-1268">
<p>On the <strong>Inspect Cluster</strong> page, you can inspect your network performance and hosts. If the inspect tool displays any issues, you can fix those issues and run the inspect tool again. Click <strong>Continue</strong>.</p>
</li>
</ul>
</div>
<div class="imageblock data-line-1270">
<div class="content">
<img src="images/ECS/inspect_cluster.png" alt="inspect cluster">
</div>
</div>
<div class="ulist data-line-1272">
<ul>
<li class="data-line-1272">
<p>The installation progress is displayed on the <strong>Install Data Services</strong> page. This step will take nearly an hour to complete.</p>
</li>
</ul>
</div>
<div class="imageblock data-line-1274">
<div class="content">
<img src="images/ECS/ecs_setup.png" alt="ecs setup">
</div>
</div>
<div class="ulist data-line-1277">
<ul>
<li class="data-line-1277">
<p>When the installation is complete, you will see the <strong>Summary</strong> image. You can now launch CDP Private Cloud.</p>
</li>
</ul>
</div>
<div class="imageblock data-line-1279">
<div class="content">
<img src="images/ECS/ecs_summary.png" alt="ecs summary">
</div>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1 data-line-1282">
<h2 id="CDP_Console">Accessing CDP Private Cloud</h2>
<div class="sectionbody">
<div class="ulist data-line-1284">
<ul>
<li class="data-line-1284">
<p>From Cloudera Manager screen, click on <strong>Data Services(New)</strong> in the left pane.</p>
</li>
</ul>
</div>
<div class="imageblock data-line-1286">
<div class="content">
<img src="images/CDE/data_svcs.png" alt="data svcs">
</div>
</div>
<div class="ulist data-line-1288">
<ul>
<li class="data-line-1288">
<p>On the <strong>CDP Private Cloud Containerized services</strong> page, click on Open CDP Private Cloud Data Services button. This will open CDP PvC authentication page.</p>
</li>
</ul>
</div>
<div class="imageblock data-line-1290">
<div class="content">
<img src="images/CDE/open_data_svs.png" alt="open data svs">
</div>
</div>
<div class="ulist data-line-1292">
<ul>
<li class="data-line-1292">
<p>If you have LDAP account credentials, then enter its username and password and then click on <strong>Login</strong>. Else, you can click on <strong>Login as Local Administrator</strong>, and enter the default credentials. (admin/admin)</p>
</li>
</ul>
</div>
<div class="imageblock data-line-1294">
<div class="content">
<img src="images/CDE/data_svcs_auth.png" alt="data svcs auth">
</div>
</div>
<div class="ulist data-line-1296">
<ul>
<li class="data-line-1296">
<p>After authenticating successfully, you will land at the CDP console/Data Services page.</p>
</li>
</ul>
</div>
<div class="imageblock data-line-1298">
<div class="content">
<img src="images/CDE/cdp_console.png" alt="cdp console">
</div>
</div>
<div class="ulist data-line-1300">
<ul>
<li class="data-line-1300">
<p>From this page, you can navigate to different data services and the management services.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1 data-line-1302">
<h2 id="_cloudera_data_engineering_cde">Cloudera Data Engineering (<strong>CDE</strong>)</h2>
<div class="sectionbody">
<div class="sect2 data-line-1304">
<h3 id="_cdp_base_cluster_requirements">CDP Base cluster requirements</h3>
<div class="paragraph data-line-1306">
<p>The Cloudera Data Engineering (<strong>CDE</strong>) service requires proper configuration of Ozone service in the Base cluster. Ensure that Ozone is running properly otherwise you will end up with issues while enabling CDE.</p>
</div>
</div>
<div class="sect2 data-line-1308">
<h3 id="_enabling_cde_service">Enabling CDE Service</h3>
<div class="ulist data-line-1310">
<ul>
<li class="data-line-1310">
<p>From the CDP console page, click on <strong>Data Engineering</strong>.</p>
</li>
</ul>
</div>
<div class="imageblock data-line-1312">
<div class="content">
<img src="images/CDE/open_cde.png" alt="open cde">
</div>
</div>
<div class="ulist data-line-1314">
<ul>
<li class="data-line-1314">
<p>This will open CDE home page. Since this will be the first time you would be opening CDE, you will not see any virtual clusters. Click on <strong>Administration</strong> in the left pane.</p>
</li>
</ul>
</div>
<div class="imageblock data-line-1316">
<div class="content">
<img src="images/CDE/cde_home.png" alt="cde home">
</div>
</div>
<div class="ulist data-line-1318">
<ul>
<li class="data-line-1318">
<p>Click on <strong>+</strong> icon as shown below which will allow you to enable CDE service post which you can create <strong>Virtual Clusters</strong>.</p>
</li>
</ul>
</div>
<div class="imageblock data-line-1320">
<div class="content">
<img src="images/CDE/enable_cde.png" alt="enable cde">
</div>
</div>
<div class="ulist data-line-1322">
<ul>
<li class="data-line-1322">
<p>On the <strong>Enable a Service</strong> page, enter the values as shown below and then click on <strong>Enable</strong>.</p>
</li>
</ul>
</div>
<div class="imageblock data-line-1324">
<div class="content">
<img src="images/CDE/enable_cde_config.png" alt="enable cde config">
</div>
</div>
<div class="paragraph data-line-1326">
<p>Please note that the cpu and memory config chosen here are minimum values. You can choose to increase it.</p>
</div>
<div class="ulist data-line-1328">
<ul>
<li class="data-line-1328">
<p>This will take approximately 30 mins after which you will be able to see a CDE service on the CDE home page.</p>
</li>
</ul>
</div>
<div class="imageblock data-line-1330">
<div class="content">
<img src="images/CDE/running_cde_svc.png" alt="running cde svc">
</div>
</div>
<div class="paragraph data-line-1331">
<p>(<em>default cde is the name given as an example. You will see as per the value you entered in the previous step</em>.)</p>
</div>
<div class="ulist data-line-1333">
<ul>
<li class="data-line-1333">
<p>The <strong>CDE Home</strong> page displays the status of the CDE service initialization. You can view logs for the service by clicking on the service vertical ellipsis (three dots) menu, and then clicking <strong>View Logs</strong>.</p>
</li>
</ul>
</div>
<div class="paragraph data-line-1336">
<p>If you are unable to see the service, then the chances are that the default virtual cluster would not have created properly. In this case, click on <strong>View Services</strong> button and then you will be able to see the CDE service enabled.</p>
</div>
<div class="imageblock data-line-1338">
<div class="content">
<img src="images/CDE/cde_svc.png" alt="cde svc">
</div>
</div>
</div>
<div class="sect2 data-line-1340">
<h3 id="_create_virtual_cluster">Create Virtual Cluster</h3>
<div class="paragraph data-line-1342">
<p>When you enable CDE service, by default a new Virtual cluster with <strong>Spark2.4</strong> will be created. If you have not enabled this option earlier, then you need to create a virtual cluster again.</p>
</div>
<div class="ulist data-line-1344">
<ul>
<li class="data-line-1344">
<p>On the CDE Home page, click on the <strong>+</strong> icon next to <strong>Virtual clusters</strong> as shown below.</p>
</li>
</ul>
</div>
<div class="imageblock data-line-1346">
<div class="content">
<img src="images/CDE/crt_vc.png" alt="crt vc">
</div>
</div>
<div class="ulist data-line-1348">
<ul>
<li class="data-line-1348">
<p>On the <strong>Create a Virtual Cluster</strong> page, enter the below values and click on <strong>Create</strong>.</p>
<div class="ulist data-line-1349">
<ul>
<li class="data-line-1349">
<p><strong>Cluster Name</strong>: Cluster Name should adhere to the below conditions.</p>
<div class="ulist data-line-1350">
<ul>
<li class="data-line-1350">
<p>Begin with a letter</p>
</li>
<li class="data-line-1351">
<p>Be between 3 and 30 characters (inclusive)</p>
</li>
<li class="data-line-1352">
<p>Contain only alphanumeric characters and hyphens</p>
</li>
</ul>
</div>
</li>
<li class="data-line-1354">
<p><strong>Service</strong>: Select the CDE service created earlier.</p>
</li>
<li class="data-line-1356">
<p><strong>Spark Version</strong>: Select the Spark version as per your requirement. If you need both <strong>Spark2.4</strong> and <strong>Spark3.7</strong>, you can create two virtual clusters provided you have sufficient resources.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="imageblock data-line-1358">
<div class="content">
<img src="images/CDE/crt_vc_choose_spark.png" alt="crt vc choose spark">
</div>
</div>
<div class="paragraph data-line-1359">
<p>This will take approximately 20 minutes.</p>
</div>
<div class="ulist data-line-1361">
<ul>
<li class="data-line-1361">
<p>You can check the logs of the cluster creation by clicking on the <strong>pencil</strong> icon and selecting the <strong>Logs</strong> section on the cluster page as shown below.</p>
</li>
</ul>
</div>
<div class="imageblock data-line-1363">
<div class="content">
<img src="images/CDE/vc_clust_details.png" alt="vc clust details">
</div>
</div>
<div class="imageblock data-line-1365">
<div class="content">
<img src="images/CDE/vc_clust_logs.png" alt="vc clust logs">
</div>
</div>
</div>
<div class="sect2 data-line-1367">
<h3 id="_initializing_virtual_cluster">Initializing Virtual Cluster</h3>
<div class="paragraph data-line-1369">
<p>Every time a new virtual cluster is created, there are a few manual steps that must be performed.</p>
</div>
<div class="ulist data-line-1371">
<ul>
<li class="data-line-1371">
<p>Log in to the ECS master and run the next set of commands as per the instructions.</p>
</li>
<li class="data-line-1373">
<p>Run the below command to create a temporary directory and navigate to the same.</p>
</li>
</ul>
</div>
<div class="listingblock data-line-1375">
<div class="content">
<pre>mkdir -p /tmp/cde-latest &amp;&amp; cd /tmp/cde-latest</pre>
</div>
</div>
<div class="ulist data-line-1379">
<ul>
<li class="data-line-1379">
<p>Download the script <a href="https://docs.cloudera.com/data-engineering/1.5.0/cdp-cde-utils.sh" data-href="https://docs.cloudera.com/data-engineering/1.5.0/cdp-cde-utils.sh">cdp-cde-utils</a> using wget.</p>
</li>
</ul>
</div>
<div class="listingblock data-line-1381">
<div class="content">
<pre>wget https://docs.cloudera.com/data-engineering/1.5.0/cdp-cde-utils.sh</pre>
</div>
</div>
<div class="ulist data-line-1385">
<ul>
<li class="data-line-1385">
<p>Add execute permission to this script.</p>
</li>
</ul>
</div>
<div class="listingblock data-line-1388">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">chmod +x /tmp/cde-latest/cdp-cde-utils.sh</code></pre>
</div>
</div>
<div class="ulist data-line-1392">
<ul>
<li class="data-line-1392">
<p>Identify the virtual cluster endpoint:</p>
<div class="ulist data-line-1394">
<ul>
<li class="data-line-1394">
<p>On the CDE homepage, select the CDE service in which the virtual cluster is created. Click on the <strong>pencil</strong> icon on the virtual cluster to be configured.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="imageblock data-line-1396">
<div class="content">
<img src="images/CDE/cde_to_vc_details.png" alt="cde to vc details">
</div>
</div>
<div class="ulist data-line-1398">
<ul>
<li class="data-line-1398">
<p>Click <strong>JOBS API URL</strong> to copy the URL to your clipboard.</p>
</li>
</ul>
</div>
<div class="imageblock data-line-1400">
<div class="content">
<img src="images/CDE/vc_jobs_api.png" alt="vc jobs api">
</div>
</div>
<div class="ulist data-line-1402">
<ul>
<li class="data-line-1402">
<p>Paste the URL into a text editor to identify the endpoint host.</p>
</li>
</ul>
</div>
<div class="paragraph data-line-1404">
<p>For example, if the URL is similar to the following:</p>
</div>
<div class="listingblock data-line-1406">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">http://dfdj6kgx.cde-2cdxw5x5.ecs-demo.example.com/dex/api/v1</code></pre>
</div>
</div>
<div class="paragraph data-line-1410">
<p>Then the endpoint will then be as shown below.</p>
</div>
<div class="paragraph data-line-1412">
<p><strong>dfdj6kgx.cde-2cdxw5x5.ecs-demo.example.com</strong></p>
</div>
<div class="ulist data-line-1414">
<ul>
<li class="data-line-1414">
<p>Once you get the endpoint of the virtual cluster, login to the ECS master and navigate to <strong>/tmp/cde-latest</strong> directory where the <strong>cdp-cde-utils.sh</strong> script is present.</p>
</li>
<li class="data-line-1416">
<p>Generate a self-signed certificate with the below command. Replace the endpoint_host with the endpoint of your virtual cluster that you got from the previous step.</p>
</li>
</ul>
</div>
<div class="listingblock data-line-1418">
<div class="content">
<pre>./cdp-cde-utils.sh init-virtual-cluster -h &lt;endpoint_host&gt; -a</pre>
</div>
</div>
<div class="paragraph data-line-1421">
<p>For the example host we used above, this command will be as below.</p>
</div>
<div class="listingblock data-line-1423">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">./cdp-cde-utils.sh init-virtual-cluster -h dfdj6kgx.cde-2cdxw5x5.ecs-demo.example.com -a</code></pre>
</div>
</div>
<div class="ulist data-line-1427">
<ul>
<li class="data-line-1427">
<p>These steps must be performed for each virtual cluster you create.</p>
</li>
</ul>
</div>
</div>
<div class="sect2 data-line-1429">
<h3 id="_configuring_ldap_users_on_cde">Configuring LDAP Users on CDE</h3>
<div class="paragraph data-line-1431">
<p>This step is required to submit the jobs to CDE from the LDAP users. For more information on how to add users to FreeIPA, refer to <a href="#Add_Users_on_IPA">Add users on FreeIPA</a></p>
</div>
<div class="ulist data-line-1433">
<ul>
<li class="data-line-1433">
<p>Log in to the ECS master host and navigate to the directory <strong>/tmp/cde-latest</strong>.</p>
</li>
</ul>
</div>
<div class="listingblock data-line-1435">
<div class="content">
<pre>cd /tmp/cde-latest</pre>
</div>
</div>
<div class="ulist data-line-1439">
<ul>
<li class="data-line-1439">
<p>Install <strong>krb5-workstation</strong> package using yum.</p>
</li>
</ul>
</div>
<div class="listingblock data-line-1441">
<div class="content">
<pre>yum install krb5-workstation -y</pre>
</div>
</div>
<div class="ulist data-line-1445">
<ul>
<li class="data-line-1445">
<p>Create a file named &lt;username&gt;.principal containing the user principal. As an example, we will consider <strong>cdpuser</strong> as the username. Here EXAMPLE.COM is the realm provided during IPA setup. You need to replace it with the realm you configured.</p>
</li>
</ul>
</div>
<div class="listingblock data-line-1447">
<div class="content">
<pre>cdpuser@EXAMPLE.COM</pre>
</div>
</div>
<div class="ulist data-line-1451">
<ul>
<li class="data-line-1451">
<p>Generate a keytab named &lt;username&gt;.keytab for the user using ktutil:</p>
</li>
</ul>
</div>
<div class="listingblock data-line-1453">
<div class="content">
<pre>sudo ktutil

ktutil:  addent -password -p cdpuser@EXAMPLE.COM -k 1 -e aes256-cts
Password for cdpuser@EXAMPLE.COM:
ktutil:  addent -password -p cdpuser@EXAMPLE.COM -k 2 -e aes128-cts
Password for cdpuser@EXAMPLE.COM:
ktutil:  wkt cdpuser.keytab
ktutil:  q</pre>
</div>
</div>
<div class="ulist data-line-1464">
<ul>
<li class="data-line-1464">
<p>Validate the keytab using klist. This command should the principals created with two encryptions provided above, namely aes256-cts and aes128-cts.</p>
</li>
</ul>
</div>
<div class="listingblock data-line-1466">
<div class="content">
<pre>klist -ekt cdpuser.keytab</pre>
</div>
</div>
<div class="ulist data-line-1470">
<ul>
<li class="data-line-1470">
<p>Validate the keytab using kinit. This command should get executed successfully.</p>
</li>
</ul>
</div>
<div class="listingblock data-line-1472">
<div class="content">
<pre>kinit -kt cdpuser.keytab cdpuser@EXAMPLE.COM</pre>
</div>
</div>
<div class="ulist data-line-1476">
<ul>
<li class="data-line-1476">
<p>Make sure that the keytab is valid before continuing. If the <strong>kinit</strong> command fails, the user will not be able to run jobs in the virtual cluster. After verifying that the kinit command succeeds, you can destroy the Kerberos ticket by running kdestroy.</p>
</li>
<li class="data-line-1478">
<p>Use the cdp-cde-utils.sh script to copy the user keytab to the virtual cluster hosts.</p>
</li>
</ul>
</div>
<div class="listingblock data-line-1481">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">./cdp-cde-utils.sh init-user-in-virtual-cluster -h &lt;endpoint_host&gt; -u &lt;user&gt; -p &lt;principal_file&gt; -k &lt;keytab_file&gt;</code></pre>
</div>
</div>
<div class="paragraph data-line-1485">
<p>For the above example, the command would like below.</p>
</div>
<div class="listingblock data-line-1487">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">./cdp-cde-utils.sh init-user-in-virtual-cluster -h dfdj6kgx.cde-2cdxw5x5.ecs-demo.example.com -u cdpuser -p cdpuser.principal -k cdpuser.keytab</code></pre>
</div>
</div>
<div class="ulist data-line-1491">
<ul>
<li class="data-line-1491">
<p>Repeat these steps for all users that need to submit jobs to the virtual cluster.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1 data-line-1493">
<h2 id="_cloudera_data_warehouse_cdw">Cloudera Data Warehouse (<strong>CDW</strong>)</h2>
<div class="sectionbody">
<div class="sect2 data-line-1495">
<h3 id="_enable_cdw_environment_and_creation_of_database_catalog">Enable CDW environment and creation of Database Catalog</h3>
<div class="ulist data-line-1497">
<ul>
<li class="data-line-1497">
<p>Open CDP Data Services page. Refer to the steps <a href="#CDP_Console">Accessing CDP Private Cloud</a> for more details.</p>
</li>
<li class="data-line-1499">
<p>Click on Data Warehouse.</p>
</li>
</ul>
</div>
<div class="imageblock data-line-1501">
<div class="content">
<img src="images/CDW/select_CDW.png" alt="select CDW">
</div>
</div>
<div class="ulist data-line-1503">
<ul>
<li class="data-line-1503">
<p>On the overview page, click on the <strong>Activate</strong> icon as shown below.</p>
</li>
</ul>
</div>
<div class="imageblock data-line-1505">
<div class="content">
<img src="images/CDW/activate_cdw.png" alt="activate cdw">
</div>
</div>
<div class="ulist data-line-1507">
<ul>
<li class="data-line-1507">
<p>On the <strong>Activate Envionrment</strong> page, enter the LDAP username and password. <strong>Enable Low resource mode</strong> and click on <strong>Activate</strong>.</p>
</li>
</ul>
</div>
<div class="imageblock data-line-1509">
<div class="content">
<img src="images/CDW/low_res_mode.png" alt="low res mode">
</div>
</div>
</div>
<div class="sect2 data-line-1511">
<h3 id="_create_virtual_warehouse">Create Virtual Warehouse</h3>
<div class="ulist data-line-1513">
<ul>
<li class="data-line-1513">
<p>Once the environment is activated, click on <strong>+</strong> icon next to Virtual Warehouses. A <strong>New Virtual Warehouse</strong> tab appears on the same page.</p>
<div class="ulist data-line-1515">
<ul>
<li class="data-line-1515">
<p>Enter the name for the new virtual warehouse(<strong>VW</strong>).</p>
</li>
<li class="data-line-1517">
<p>Choose the type of VW, Hive or Impala.</p>
</li>
<li class="data-line-1519">
<p>Choose the default Database catalog that appears in the dropdown.</p>
</li>
<li class="data-line-1521">
<p>Choose Size as <strong>xsmall-2 Executors</strong>.</p>
</li>
<li class="data-line-1523">
<p>AutoSuspend: If you want the VW to keep running all the time, you can <strong>Disable</strong> it.</p>
</li>
<li class="data-line-1525">
<p>Keep the remaining parameters default and click on <strong>Create</strong>.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="imageblock data-line-1527">
<div class="content">
<img src="images/CDW/crt_wh.png" alt="crt wh">
</div>
</div>
<div class="ulist data-line-1529">
<ul>
<li class="data-line-1529">
<p>A new Virtual Warehouse will be created. You can use <strong>Hue</strong> to submit queries to the underlying engine of the Virtual Warehouse.</p>
</li>
</ul>
</div>
<div class="imageblock data-line-1531">
<div class="content">
<img src="images/CDW/vw_hue.png" alt="vw hue">
</div>
</div>
</div>
</div>
</div>
<div class="sect1 data-line-1533">
<h2 id="_cloudera_machine_learning_cml">Cloudera Machine Learning (<strong>CML</strong>)</h2>
<div class="sectionbody">
<div class="sect2 data-line-1535">
<h3 id="_ml_workspace_creation">ML Workspace Creation</h3>
<div class="ulist data-line-1537">
<ul>
<li class="data-line-1537">
<p>From the CDP Data Services page, click on <strong>Machine Learning</strong>.</p>
</li>
</ul>
</div>
<div class="imageblock data-line-1539">
<div class="content">
<img src="images/CML/cdp_CML.png" alt="cdp CML">
</div>
</div>
<div class="ulist data-line-1541">
<ul>
<li class="data-line-1541">
<p>Since this will be the first time you opening <strong>CML</strong>, there will be no <strong>ML workspace</strong>. You will see the screen as below.</p>
</li>
</ul>
</div>
<div class="imageblock data-line-1543">
<div class="content">
<img src="images/CML/ml_workspc_empty.png" alt="ml workspc empty">
</div>
</div>
<div class="ulist data-line-1545">
<ul>
<li class="data-line-1545">
<p>Click on <strong>Provision Workspace</strong> on the same page.</p>
</li>
</ul>
</div>
<div class="imageblock data-line-1547">
<div class="content">
<img src="images/CML/prov_ml_workspc.png" alt="prov ml workspc">
</div>
</div>
<div class="ulist data-line-1549">
<ul>
<li class="data-line-1549">
<p>Enter the configuration values for the workspace as described below.</p>
<div class="ulist data-line-1551">
<ul>
<li class="data-line-1551">
<p><strong>Workspace name</strong>: A suitable name for the workspace.</p>
</li>
<li class="data-line-1553">
<p><strong>Environment</strong>: Select the default environment from the drop down.</p>
</li>
<li class="data-line-1555">
<p><strong>Namespace</strong>: This will be the kubernetes namespace under which the pods would be spinned up. By default, it is set to <strong>cml</strong>. You can change it if you wish to.</p>
</li>
<li class="data-line-1557">
<p><strong>NFS server</strong>: Select <strong>Internal</strong>.</p>
</li>
</ul>
</div>
</li>
<li class="data-line-1559">
<p>Under <strong>Production Learning</strong>, the below parameters need to be updated.</p>
<div class="ulist data-line-1561">
<ul>
<li class="data-line-1561">
<p><strong>Enable Governance</strong>: This provided advanced lineage and governance features. For simple demos or POCs, you may choose to disable it.</p>
</li>
<li class="data-line-1563">
<p><strong>Enable Model Metrics</strong>: Keep it enabled. It provides you with the metrics.</p>
</li>
<li class="data-line-1565">
<p><strong>Enable TLS</strong>: You can keep it disabled.</p>
</li>
<li class="data-line-1567">
<p><strong>Enable Monitoring</strong>: This helps in monitoring the resource usage for the provisioned workspace. Enable it.</p>
</li>
<li class="data-line-1569">
<p><strong>CML Static Subdomain</strong>: Enter any short name for this parameter that helps in monitoring the resource usage for the provisioned workspace.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="imageblock data-line-1571">
<div class="content">
<img src="images/CML/workspc_config_2.png" alt="workspc config 2">
</div>
</div>
<div class="ulist data-line-1573">
<ul>
<li class="data-line-1573">
<p>Once it is created, it appears on the CML <strong>Workspaces</strong> page as shown below.</p>
</li>
</ul>
</div>
<div class="imageblock data-line-1575">
<div class="content">
<img src="images/CML/created_wrkspc.png" alt="created wrkspc">
</div>
</div>
</div>
<div class="sect2 data-line-1577">
<h3 id="_create_project">Create Project</h3>
<div class="ulist data-line-1579">
<ul>
<li class="data-line-1579">
<p>Click on the newly created workspace. It will open the <strong>Projects</strong> screen of CML.</p>
</li>
</ul>
</div>
<div class="imageblock data-line-1581">
<div class="content">
<img src="images/CML/click_on_workspc.png" alt="click on workspc">
</div>
</div>
<div class="ulist data-line-1583">
<ul>
<li class="data-line-1583">
<p>At the top right, you will find <strong>New Project</strong> button. Click on it.  <strong>New Project</strong> page appears.
Enter the details as described below.</p>
<div class="ulist data-line-1586">
<ul>
<li class="data-line-1586">
<p><strong>Project Name</strong>: Enter a suitable name for your project.</p>
</li>
<li class="data-line-1588">
<p><strong>Project Description</strong>: Enter a description for the project.</p>
</li>
<li class="data-line-1590">
<p><strong>Project Visibility</strong>: Keep it <strong>Public</strong> for any demos or poc&#8217;s. If you are creating this in a multi-tenant environment, choose <strong>Private</strong>.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="imageblock data-line-1592">
<div class="content">
<img src="images/CML/project_creation_1.png" alt="project creation 1">
</div>
</div>
<div class="ulist data-line-1594">
<ul>
<li class="data-line-1594">
<p>The <strong>Initial Setup</strong> for the project has five options as described below. Choose any of these based on your requirement.</p>
<div class="ulist data-line-1596">
<ul>
<li class="data-line-1596">
<p><strong>Blank</strong>: Choose this if you want to start from scratch.</p>
</li>
<li class="data-line-1598">
<p><strong>Template</strong>: Template projects contain example code that can help you get started with Cloudera Machine Learning. They are available in R, Python, PySpark, and Scala. Using a template project is not required, but it helps you start using Cloudera Machine Learning right away.</p>
</li>
<li class="data-line-1600">
<p><strong>AMPs</strong>: Applied ML Prototypes provide components to create a complete project. They may include jobs, models and experiments.</p>
</li>
<li class="data-line-1602">
<p><strong>Local Files</strong>: Choose this if you have all the necessary files in a folder or in a zip.</p>
</li>
<li class="data-line-1604">
<p><strong>Git</strong>: Choose this if all the resources are stored in a github project.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="imageblock data-line-1606">
<div class="content">
<img src="images/CML/project_initial_setup.png" alt="project initial setup">
</div>
</div>
<div class="ulist data-line-1608">
<ul>
<li class="data-line-1608">
<p><strong>Runtime Setup</strong>: For inital exploration, select <strong>Basic</strong> and keep the kernel to <strong>Python3.7</strong>.</p>
</li>
</ul>
</div>
<div class="imageblock data-line-1610">
<div class="content">
<img src="images/CML/project_runtime_setup.png" alt="project runtime setup">
</div>
</div>
<div class="ulist data-line-1612">
<ul>
<li class="data-line-1612">
<p>Click on <strong>Create Project</strong>. After some time, a new project will be created and will be
available on the <strong>Projects</strong> page.</p>
</li>
</ul>
</div>
<div class="imageblock data-line-1615">
<div class="content">
<img src="images/CML/new_created_project.png" alt="new created project">
</div>
</div>
</div>
<div class="sect2 data-line-1617">
<h3 id="_hadoop_authentication">Hadoop Authentication</h3>
<div class="ulist data-line-1619">
<ul>
<li class="data-line-1619">
<p>Before starting any new session, you must complete the hadoop authentication part as it is kerberized. Go to <strong>CML</strong> home page and click on <strong>User Settings</strong> in the left pane. Click on <strong>Hadoop Authentication</strong>.</p>
</li>
</ul>
</div>
<div class="imageblock data-line-1621">
<div class="content">
<img src="images/CML/hadoop_authentication.png" alt="hadoop authentication">
</div>
</div>
<div class="ulist data-line-1623">
<ul>
<li class="data-line-1623">
<p>Enter the principal and keytab details of the LDAP user and click on <strong>Authenticate</strong>.</p>
</li>
<li class="data-line-1625">
<p>Once the authentication is successful, proceed to the next step.</p>
</li>
</ul>
</div>
</div>
<div class="sect2 data-line-1627">
<h3 id="_explore_cml_ides">Explore CML IDEs</h3>
<div class="ulist data-line-1629">
<ul>
<li class="data-line-1629">
<p>Go the the <strong>Project</strong> page and click on the newly created project and then click on <strong>New Session</strong> button on the top right. Explore CML by running the jobs with different IDEs like <strong>Jupyterlab</strong> and <strong>Workbench</strong>.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1 data-line-1647">
<h2 id="_appendix">Appendix</h2>
<div class="sectionbody">
<div class="sect2 data-line-1649">
<h3 id="Add_Users_on_IPA">Add users on FreeIPA</h3>
<div class="ulist data-line-1651">
<ul>
<li class="data-line-1651">
<p>Log in to IPA server and run kinit with admin and enter the password.</p>
</li>
</ul>
</div>
<div class="listingblock data-line-1653">
<div class="content">
<pre>kinit admin</pre>
</div>
</div>
<div class="ulist data-line-1657">
<ul>
<li class="data-line-1657">
<p>Run the below command to create a user. Enter the password in the password prompt.</p>
</li>
</ul>
</div>
<div class="listingblock data-line-1659">
<div class="content">
<pre>ipa user-add --password &lt;User Name&gt;</pre>
</div>
</div>
<hr>
<div class="paragraph data-line-1664">
<p><strong>Authors</strong></p>
</div>
<div class="paragraph data-line-1666">
<p>Puneet Joshi <a href="mailto:puneetjoshi@cloudera.com" data-href="mailto:puneetjoshi@cloudera.com">puneetjoshi@cloudera.com</a></p>
</div>
<div class="paragraph data-line-1668">
<p>Pannag Katti <a href="mailto:pkatti@cloudera.com" data-href="mailto:pkatti@cloudera.com">pkatti@cloudera.com</a></p>
</div>
<div class="paragraph data-line-1670">
<p>version-1.0, Feb 22, 2023</p>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2023-04-10 18:13:57 +0550
</div>
</div>
</body>
</html>